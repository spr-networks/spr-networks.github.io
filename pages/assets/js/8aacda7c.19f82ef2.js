"use strict";(self.webpackChunkspr_docs=self.webpackChunkspr_docs||[]).push([[9093],{14379:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>c,frontMatter:()=>a,metadata:()=>t,toc:()=>l});var t=i(72007),s=i(74848),r=i(28453);const a={slug:"spr_mini_pc",title:"Running SPR on a Mini PC with WiFi 6",authors:"ltsrad",tags:["SPR","x64","80211ax"]},o=void 0,d={authorsImageUrls:[void 0]},l=[{value:"Intro",id:"intro",level:2},{value:"First, get a Mini PC ready",id:"first-get-a-mini-pc-ready",level:2},{value:"Setup",id:"setup",level:2},{value:"Configure hostapd for 802.11AX",id:"configure-hostapd-for-80211ax",level:2},{value:"Some Notes on the MT7915",id:"some-notes-on-the-mt7915",level:2}];function h(e){const n={a:"a",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"intro",children:"Intro"}),"\n",(0,s.jsx)(n.p,{children:"In the blog post we'll describe how to build and run SPR on a Mini-PC. And we'll use a WiFi 6 capable radio inside."}),"\n",(0,s.jsx)(n.h2,{id:"first-get-a-mini-pc-ready",children:"First, get a Mini PC ready"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Identify a good mini PC to use. ",(0,s.jsx)(n.a,{href:"https://twitter.com/willy_wong",children:"Wilson"})," suggested\na look at QOTOM's i3 broadwell routers."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.a,{href:"https://amzn.to/36qmZjI",children:"g330"})," is not bad. It's a fanless build with a TDP of 15W. One mini pci-e slot is dedicated to ",(0,s.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Serial_ATA#Mini-SATA_(mSATA)",children:"mSATA"}),", and the other can be used to fit a wifi radio. It also has additional SATA available for one more storage drive."]}),"\n",(0,s.jsx)("a",{href:"https://amzn.to/36qmZjI",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://m.media-amazon.com/images/I/61KcP6zQLsL._AC_SX679_.jpg",alt:""})})}),"\n",(0,s.jsx)(n.p,{children:"WARNING: On this device, the mini-pcie slot has a tall post for half-sized cards that needs to be removed to fit thicker full sized WiFi cards."}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"Get a good WiFi radio."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"We'll run with an 802.11ax card that works with Linux in AP mode (at least 802.11ac is recommended)."}),"\n",(0,s.jsxs)(n.p,{children:["Mediatek is the disruptor in this space and supports AP mode on Linux. [NOTE: Many other cards will NOT work with ax in AP mode on Linux with open source drivers] . If you have recommendations please do not hesitate to reach out on the ",(0,s.jsx)(n.a,{href:"https://matrix.to/#/#spr:matrix.org",children:"matrix chat"}),".  For the G330 Qotom, 2 antennas wires are provided to outside the case, so the 2x2 configuration is best."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.a,{href:"https://www.asiarf.com/shop/wifi-wlan/wifi_mini_pcie/wifi6-2t2r-dual-bands-dbdc-mpcie-card-11ax-mt7915-aw7915-npd/",children:"MT7915"})," can be purchased from AsiaRF."]}),"\n",(0,s.jsx)("a",{href:"https://www.asiarf.com/shop/wifi-wlan/wifi_mini_pcie/wifi6-2t2r-dual-bands-dbdc-mpcie-card-11ax-mt7915-aw7915-npd/",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://sp-ao.shortpixel.ai/client/to_webp,q_glossy,ret_img,w_400,h_400/https://www.asiarf.com/wp-content/uploads/2021/07/aw7915-npd-1_top.jpg",alt:""})})}),"\n",(0,s.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,s.jsxs)(n.p,{children:["Download and install Ubuntu Server. Since the WiFi 6 driver is a work in progress, we grabbed a daily release of ",(0,s.jsx)(n.a,{href:"https://cdimage.ubuntu.com/ubuntu-server/daily-live/current/jammy-live-server-amd64.iso",children:"Jammy Jellyfish 22.04"})," from the ",(0,s.jsx)(n.a,{href:"https://cdimage.ubuntu.com/ubuntu-server/daily-live/current/",children:"Ubuntu Live"})," page to get the latest fixes. Copy the installer to installation media (a flash drive) then plug it in and go."]}),"\n",(0,s.jsxs)(n.p,{children:["Then follow the ",(0,s.jsx)(n.a,{href:"/docs/setup_guides/setup_run_spr",children:"SPR Setup Guide"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Our config/base/config.sh:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"#!/bin/sh                                                                                                              \nSSID_NAME=6lab                                                                                                         \nSSID_INTERFACE=wlan1                                                                                                   \n\n#PPPIF=eth0                                                                                                            \n#WANIF=ppp0\n#PPP_VLANID=201\n#PPP_PROVIDER=provider-config\nWANIF=enp1s0\nRUN_WAN_DHCP=true\nRUN_WAN_DHCP_IPV=4\n# Uncomment the next line if a second ethernet port goes to wired LAN\n#LANIF=eth1\nVLANIF=wlan1\nVLANSIF=$VLANIF.\n\nLANIP=192.168.3.1\nDNSIP=$LANIP\nTINYNETSTART=192.168.3.4\nTINYNETSTOP=192.168.3.255\nTINYNETMASK=255.255.255.252\nTINYSLASHMASK=30\nDOCKERNET=172.17.0.0/16\nDOCKERIF=docker0\n\nWIREGUARD_PORT=51280\n#WIREGUARD_NETWORK=192.168.3.1/24\n"})}),"\n",(0,s.jsx)(n.h2,{id:"configure-hostapd-for-80211ax",children:"Configure hostapd for 802.11AX"}),"\n",(0,s.jsxs)(n.p,{children:["On the SPR device, modify ",(0,s.jsx)(n.code,{children:"configs/wifi/hostapd.conf"})," and add:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"ieee80211ax=1\nhe_su_beamformer=1\nhe_su_beamformee=1\nhe_mu_beamformer=1\nhe_oper_chwidth=1 # 80mhz channel\nhe_oper_centr_freq_seg0_idx=42\n"})}),"\n",(0,s.jsx)(n.p,{children:"Restart wifid"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"docker compose restart wifid\n"})}),"\n",(0,s.jsx)(n.p,{children:"Connect a wifi 6 client and verify HE codings are available"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"# iw dev wlan1.4096 station dump -v  | grep bitrate\n        tx bitrate:     1200.9 MBit/s 80MHz HE-MCS 11 HE-NSS 2 HE-GI 0 HE-DCM 0\n        rx bitrate:     720.6 MBit/s 80MHz HE-MCS 7 HE-NSS 2 HE-GI 0 HE-DCM 0\n"})}),"\n",(0,s.jsx)(n.h2,{id:"some-notes-on-the-mt7915",children:"Some Notes on the MT7915"}),"\n",(0,s.jsxs)(n.p,{children:["The MT7915 is a Dual Mode driver. This means that it supports both 2Ghz and 5Ghz\nfrequencies simultaneously. For our install the 2ghz interface is on ",(0,s.jsx)(n.code,{children:"wlan0"})," and 5Ghz on ",(0,s.jsx)(n.code,{children:"wlan1"}),". This is really wonderful, since one card can serve older IOT devices that only run on 2Ghz as well as more modern devices at high speeds."]}),"\n",(0,s.jsxs)(n.p,{children:["The linux kernel driver is not yet as stable as it could be, so beware that it may not yet be production ready -- several assertions and crashes were noticed. The mainline kernel does not yet support radar scanning, however the code is available in the ",(0,s.jsx)(n.a,{href:"https://github.com/openwrt/mt76",children:"openwrt development branch"}),"."]})]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var t=i(96540);const s={},r=t.createContext(s);function a(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(r.Provider,{value:n},e.children)}},72007:e=>{e.exports=JSON.parse('{"permalink":"/pages/blog/spr_mini_pc","source":"@site/blog/2022-03-18-x64-support.md","title":"Running SPR on a Mini PC with WiFi 6","description":"Intro","date":"2022-03-18T00:00:00.000Z","tags":[{"inline":true,"label":"SPR","permalink":"/pages/blog/tags/spr"},{"inline":true,"label":"x64","permalink":"/pages/blog/tags/x-64"},{"inline":true,"label":"80211ax","permalink":"/pages/blog/tags/80211-ax"}],"readingTime":3.26,"hasTruncateMarker":true,"authors":[{"name":"Alex Radocea","url":"https://twitter.com/defendtheworld","key":"ltsrad","page":null}],"frontMatter":{"slug":"spr_mini_pc","title":"Running SPR on a Mini PC with WiFi 6","authors":"ltsrad","tags":["SPR","x64","80211ax"]},"unlisted":false,"prevItem":{"title":"Gigabit WiFi with SPR & The 4x4 MT7915","permalink":"/pages/blog/wifi6"},"nextItem":{"title":"Supernetworks just Released a React User Interface","permalink":"/pages/blog/UI Push"}}')}}]);