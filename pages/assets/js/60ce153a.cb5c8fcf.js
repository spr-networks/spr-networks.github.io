"use strict";(self.webpackChunkspr_docs=self.webpackChunkspr_docs||[]).push([[8331],{8950:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>c,toc:()=>a});var i=n(85893),r=n(11151);const t={},l="SPRbus",c={id:"services/sprbus",title:"SPRbus",description:"version",source:"@site/docs/services/sprbus.md",sourceDirName:"services",slug:"/services/sprbus",permalink:"/pages/docs/services/sprbus",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"PPP",permalink:"/pages/docs/services/ppp"},next:{title:"Superd",permalink:"/pages/docs/services/superd"}},d={},a=[{value:"Usage",id:"usage",level:2},{value:"Available events",id:"available-events",level:2},{value:"Example Events",id:"example-events",level:2},{value:"Command line tools",id:"command-line-tools",level:2}];function o(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"sprbus",children:"SPRbus"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.img,{src:"https://img.shields.io/github/v/tag/spr-networks/sprbus?sort=semver&label=version",alt:"version"}),"\n",(0,i.jsx)(s.a,{href:"https://goreportcard.com/report/github.com/spr-networks/sprbus",children:(0,i.jsx)(s.img,{src:"https://goreportcard.com/badge/github.com/spr-networks/sprbus",alt:"Go Report Card"})})]}),"\n",(0,i.jsx)(s.p,{children:"SPRbus is the event bus used in SPR to send and subscribe to events."}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.a,{href:"https://github.com/spr-networks/sprbus/tree/main",children:" \u21e8 View the code"})}),"\n",(0,i.jsx)(s.h2,{id:"usage",children:"Usage"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"/pages/docs/services/db",children:"db"})," is listening for events and store these in a database"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"/pages/docs/services/packet_logs",children:"packet logs"})," send events when netfilter rules are triggered"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"/pages/docs/apis/overview",children:"api"})," for notifications"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"/pages/docs/apis/overview",children:"api"})," publish event for access log"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"/pages/docs/services/dns",children:"dns"})," send events on domain lookup or block"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"available-events",children:"Available events"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["auth",":success"]}),"\n",(0,i.jsxs)(s.li,{children:["auth",":failure"]}),"\n",(0,i.jsxs)(s.li,{children:["dns:block",":event"]}),"\n",(0,i.jsxs)(s.li,{children:["dns:blockrebind",":event"]}),"\n",(0,i.jsxs)(s.li,{children:["dns:override",":event"]}),"\n",(0,i.jsxs)(s.li,{children:["dns:serve",":clientip"," (Ex: 192.168.2.2)"]}),"\n",(0,i.jsxs)(s.li,{children:["dhcp",":request"]}),"\n",(0,i.jsxs)(s.li,{children:["dhcp",":response"]}),"\n",(0,i.jsxs)(s.li,{children:["dhcp",":update"]}),"\n",(0,i.jsxs)(s.li,{children:["device",":save"]}),"\n",(0,i.jsxs)(s.li,{children:["device:tags",":update"]}),"\n",(0,i.jsxs)(s.li,{children:["device:groups",":update"]}),"\n",(0,i.jsxs)(s.li,{children:["log",":api"]}),"\n",(0,i.jsxs)(s.li,{children:["log:www",":access"]}),"\n",(0,i.jsxs)(s.li,{children:["nft:lan",":in"]}),"\n",(0,i.jsxs)(s.li,{children:["nft:lan",":out"]}),"\n",(0,i.jsxs)(s.li,{children:["nft:wan",":in"]}),"\n",(0,i.jsxs)(s.li,{children:["nft:wan",":out"]}),"\n",(0,i.jsxs)(s.li,{children:["nft:drop",":private"]}),"\n",(0,i.jsxs)(s.li,{children:["nft:drop",":forward"]}),"\n",(0,i.jsxs)(s.li,{children:["nft:drop",":input"]}),"\n",(0,i.jsxs)(s.li,{children:["nft:drop",":mac"]}),"\n",(0,i.jsxs)(s.li,{children:["wg",":update"]}),"\n",(0,i.jsxs)(s.li,{children:["wifi:auth",":fail"]}),"\n",(0,i.jsxs)(s.li,{children:["wifi:auth",":success"]}),"\n",(0,i.jsxs)(s.li,{children:["wifi:station",":disconnect"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"example-events",children:"Example Events"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.em,{children:"wifi:auth:success"})," is published when a device connects"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.em,{children:"device:save"})," is published when a device is updated"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.a,{href:"/pages/api/0",children:"View the API documentation for sprbus here"})}),"\n",(0,i.jsxs)(s.p,{children:["By default ",(0,i.jsx)(s.em,{children:"log:api"}),", ",(0,i.jsx)(s.em,{children:"dns:block:event"}),", ",(0,i.jsx)(s.em,{children:"dns:override:event"}),", ",(0,i.jsx)(s.em,{children:"dns:serve:"})," events are stored in the database.\nThe log items can be viewed under ",(0,i.jsx)(s.em,{children:"System -> Logs"}),".\nIf you want to store more events you can add them in the web ui under ",(0,i.jsx)(s.em,{children:"System -> System Info -> Database"}),"."]}),"\n",(0,i.jsx)(s.h2,{id:"command-line-tools",children:"Command line tools"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"sprbus",src:n(73626).Z+"",width:"1200",height:"750"})}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/spr-networks/sprbus/blob/main/cmd/main.go",children:"cmd/main.go"})]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:"cd cmd/; make\n./sprbus --help\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"remote"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:'export TOKEN="SPR-API-TOKEN"\n./sprbus --addr 192.168.2.1\n'})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"local"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:"./sprbus\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"example topics"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:"#www and api logs\n./sprbus -t log\n# device and wifi events\n./sprbus -t device,wifi\n#network traffic\n./sprbus -t nft\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"network traffic in json, no timeout and pipe to jq"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:"./sprbus -t nft -j --timeout 0 | jq .\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"publish test event"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:'./sprbus -t test:event -p \'{"msg": "testevent1234"}\'\n'})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.img,{alt:"sprbus intro",src:n(25672).Z+"",width:"1200",height:"600"}),"\nexample showing how to publish events."]}),"\n",(0,i.jsx)(s.h1,{id:"development",children:"Development"}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/spr-networks/sprbus/blob/main/example/main.go",children:"example/main.go"})]}),"\n",(0,i.jsx)(s.p,{children:"using default sprbus:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-golang",children:'//publish json string\nsprbus.PublishString("wifi:station:event", "{\\"json\\": \\"data\\"}")\n\n//publish object\nsprbus.Publish("www:auth:user:fail", map[string]string{"username": username})\n\n//subscribe\ngo sprbus.HandleEvent("wifi", func (topic string, json string) {\n    fmt.Println("wifi event", topic, json)\n})\n'})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Custom unix socket server and client"})}),"\n",(0,i.jsxs)(s.p,{children:["See ",(0,i.jsx)(s.a,{href:"https://github.com/spr-networks/sprbus/blob/main/example/main.go",children:"example/main.go"})," for code to setup a custom unix socket server and client"]})]})}function h(e={}){const{wrapper:s}={...(0,r.a)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},73626:(e,s,n)=>{n.d(s,{Z:()=>i});const i=n.p+"assets/images/sprbus-cli-476cc4f905e635d16c3fdcc0041fc30a.gif"},25672:(e,s,n)=>{n.d(s,{Z:()=>i});const i=n.p+"assets/images/sprbus-publish-2e19f79fbd12c9a023895bb244710806.gif"},11151:(e,s,n)=>{n.d(s,{Z:()=>c,a:()=>l});var i=n(67294);const r={},t=i.createContext(r);function l(e){const s=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:s},e.children)}}}]);