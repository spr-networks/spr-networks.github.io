"use strict";(self.webpackChunkspr_docs=self.webpackChunkspr_docs||[]).push([[4519],{69871:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>c,contentTitle:()=>h,default:()=>u,frontMatter:()=>s,metadata:()=>r,toc:()=>l});var i=n(85893),a=n(11151),o=n(63017);const s={slug:"80211-authentication-association-authorization-wifi",title:"Authentication, Association, and Authorization in 802.11 WiFi",authors:["ltsrad"],tags:["wifi","authentication","association","authorization"]},h=void 0,r={permalink:"/pages/blog/80211-authentication-association-authorization-wifi",source:"@site/blog/2024-09-06-authentication-association-authorization.md",title:"Authentication, Association, and Authorization in 802.11 WiFi",description:'Association in the 802.11/ WiFi World comes in the "loose" variety of the term, and why Hostapd disconnect events are confusing...',date:"2024-09-06T00:00:00.000Z",tags:[{inline:!0,label:"wifi",permalink:"/pages/blog/tags/wifi"},{inline:!0,label:"authentication",permalink:"/pages/blog/tags/authentication"},{inline:!0,label:"association",permalink:"/pages/blog/tags/association"},{inline:!0,label:"authorization",permalink:"/pages/blog/tags/authorization"}],readingTime:3.715,hasTruncateMarker:!0,authors:[{name:"Alex Radocea",url:"https://twitter.com/defendtheworld",key:"ltsrad",page:null}],frontMatter:{slug:"80211-authentication-association-authorization-wifi",title:"Authentication, Association, and Authorization in 802.11 WiFi",authors:["ltsrad"],tags:["wifi","authentication","association","authorization"]},unlisted:!1,nextItem:{title:"Loading Out of Tree Rust in Linux",permalink:"/pages/blog/loading-your-own-rust-kernel-modules"}},c={authorsImageUrls:[void 0]},l=[{value:"Association is Not Authentication",id:"association-is-not-authentication",level:3},{value:"Authentication is Not Authentication",id:"authentication-is-not-authentication",level:3},{value:"Authorization Happens With EAPOL",id:"authorization-happens-with-eapol",level:3},{value:"What Is A Disconnection in the Ether Anyway?",id:"what-is-a-disconnection-in-the-ether-anyway",level:3},{value:"HostAP Uses Radio Presence for Inactivity",id:"hostap-uses-radio-presence-for-inactivity",level:3},{value:"Conclusion",id:"conclusion",level:2},{value:"Looking to dive into the 802.11 Protocol?",id:"looking-to-dive-into-the-80211-protocol",level:3}];function d(t){const e={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,a.a)(),...t.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.p,{children:'Association in the 802.11/ WiFi World comes in the "loose" variety of the term, and why Hostapd disconnect events are confusing...'}),"\n","\n",(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,i.jsx)("img",{src:o.Z,style:{width:"100%"}})}),"\n",(0,i.jsx)(e.p,{children:"As a quick recap: when a station connects to an Access Point, it goes through a series of request/reply interactions.\nSeveral frames are in play including Probes, Authentication, Association, and finally Data frames with EAPOL. The EAPOL payloads perform all the fun cryptography with the passphrase for WPA2, WPA3, and 802.1X Authentication mechanisms."}),"\n",(0,i.jsx)(e.h3,{id:"association-is-not-authentication",children:"Association is Not Authentication"}),"\n",(0,i.jsx)(e.p,{children:"As shown in the diagram, the flow has Authentication, Association, and then EAPOL. The Association frames happen before the cryptography is happening with WPA2. Nothing is authenticated at this point. Association lets an Access Point be aware that a Station has associated itself and will begin sending data for the AP to receive."}),"\n",(0,i.jsx)(e.h3,{id:"authentication-is-not-authentication",children:"Authentication is Not Authentication"}),"\n",(0,i.jsx)(e.p,{children:"Wait a second. Authentication already happened? Why is EAPOL happening?"}),"\n",(0,i.jsxs)(e.p,{children:["Well it turns out that the Authentication frames for secure wifi today never do authentication, because they only support ",(0,i.jsx)(e.a,{href:"https://www.sciencedirect.com/topics/computer-science/key-authentication",children:"insecure cryptography like RC4/WEP"}),' under "Shared Key Auth". Because the frame format was hard to extend and keep backwards compatible, 802.11 went down the path of going with "Open System Auth" and handling authentication later.  So today we let WEP rest in the crypt :-)']}),"\n",(0,i.jsx)(e.h3,{id:"authorization-happens-with-eapol",children:"Authorization Happens With EAPOL"}),"\n",(0,i.jsxs)(e.p,{children:["So once the EAPOL 4-way handshake is happy, we have authentication, and the Access Point authorizes the station to send data. All is well. Hostapd will set the ",(0,i.jsx)(e.code,{children:"[Authorized]"})," flag on the station as well to reflect this."]}),"\n",(0,i.jsx)(e.p,{children:"The takeaway here is that when you're building a WiFi system, \"associated\" stations have not done much more than express an interest in connecting and authenticating. This is convenient for example for knowing if there's a station out there that's confused."}),"\n",(0,i.jsx)(e.p,{children:"When SPR runs as a router, it can alert on WiFi Auth failures -- and it will also warn in the Devices view about stations hanging out that haven't authenticated with EAPOL. This helps users debug their wireless environment when something can't connect."}),"\n",(0,i.jsx)(e.h3,{id:"what-is-a-disconnection-in-the-ether-anyway",children:"What Is A Disconnection in the Ether Anyway?"}),"\n",(0,i.jsx)(e.p,{children:"So we've covered the connection half of these nebulous things in 802.11 named Authentication & Association."}),"\n",(0,i.jsxs)(e.p,{children:["But how does disconnection work? Well devices/APs can send a Deauth / Disassociate frame to let the AP know it's leaving. For more details on these check out ",(0,i.jsx)(e.a,{href:"https://www.nzyme.org/knowledge/wifi/deauthentication-frames-explained",children:"Deauthentication Frames Explained"}),"."]}),"\n",(0,i.jsx)(e.p,{children:"But we have no physical wire. A station is not obligated to send these along, and very often they don't, it would be extra packets on the medium to be aggressive about sending these when leaving the environment. The protocol designers are very aware that 802.11 transmission is half-duplex. Only one system can transmit over a channel at a time, and senders have to wait for a transmitter to complete their frame, so skipping these is not a bad thing"}),"\n",(0,i.jsx)(e.p,{children:"Which leads to the next confusing thing:"}),"\n",(0,i.jsx)(e.h3,{id:"hostap-uses-radio-presence-for-inactivity",children:"HostAP Uses Radio Presence for Inactivity"}),"\n",(0,i.jsx)(e.p,{children:"Activity in the hostapd world means that when a station's MAC address is seen transmitting, it's considered active."}),"\n",(0,i.jsx)(e.p,{children:"This means that a client could remain associated with an AP, even if it's connected to a new AP. The disconnect event could then happen long after the station has moved on."}),"\n",(0,i.jsx)(e.p,{children:"To make this a little smoother, hostapd also provides an option to disconnect sooner."}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"#\n# The inactivity polling can be disabled to disconnect stations based on\n# inactivity timeout so that idle stations are more likely to be disconnected\n# even if they are still in range of the AP. This can be done by setting\n# skip_inactivity_poll to 1 (default 0).\n#skip_inactivity_poll=0\n"})}),"\n",(0,i.jsx)(e.p,{children:"In our Mesh support -- we can't rely on HostAP disconnect events to rewire devices between mesh nodes.\nInstead we use the authorization to the new Mesh AP to refresh the routing."}),"\n",(0,i.jsx)(e.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsx)(e.p,{children:"This post adds clarity to the confusion in the 802.11 world's usage of the terms Authentication, Association, and Authorization. They are not as straightforward as they sound because of the winding history of WiFi Authentication."}),"\n",(0,i.jsx)(e.h3,{id:"looking-to-dive-into-the-80211-protocol",children:"Looking to dive into the 802.11 Protocol?"}),"\n",(0,i.jsxs)(e.p,{children:["Check out our ",(0,i.jsx)(e.a,{href:"https://github.com/spr-networks/barely-ap/blob/main/src/ap.py",children:"Reference WPA2 Access Point in Scapy"}),". It's been featured in ",(0,i.jsx)(e.a,{href:"https://github.com/Nautilus-Institute/quals-2023/tree/main/wifi",children:"Defcon Qualifers"})," ",(0,i.jsx)(e.a,{href:"https://github.com/Nautilus-Institute/finals-2023/tree/main/dron-ap",children:"and Finals"}),", our ",(0,i.jsx)(e.a,{href:"https://github.com/spr-networks/turtles-march-2023",children:"Turtles"})," challenges, as well as the Midnight Sun CTF. It handles everything needed to let modern devices connect with WPA2 Authentication and send traffic."]})]})}function u(t={}){const{wrapper:e}={...(0,a.a)(),...t.components};return e?(0,i.jsx)(e,{...t,children:(0,i.jsx)(d,{...t})}):d(t)}},63017:(t,e,n)=>{n.d(e,{Z:()=>i});const i=n.p+"assets/images/aaa-to-handshake-d2d052b66870db1b94784e4caf183df4.png"},11151:(t,e,n)=>{n.d(e,{Z:()=>h,a:()=>s});var i=n(67294);const a={},o=i.createContext(a);function s(t){const e=i.useContext(o);return i.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function h(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(a):t.components||a:s(t.components),i.createElement(o.Provider,{value:e},t.children)}}}]);