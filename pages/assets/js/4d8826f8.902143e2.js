"use strict";(self.webpackChunkspr_docs=self.webpackChunkspr_docs||[]).push([[5063],{39558:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>a,frontMatter:()=>r,metadata:()=>o,toc:()=>p});var i=s(85893),l=s(11151);const r={sidebar_position:1},t="Plugin Development",o={id:"development/plugin-dev",title:"Plugin Development",description:"See the sample repos for how to get started and running a plugin in dev mode:",source:"@site/docs/development/plugin-dev.md",sourceDirName:"development",slug:"/development/plugin-dev",permalink:"/pages/docs/development/plugin-dev",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Overview",permalink:"/pages/docs/development/overview"},next:{title:"Base",permalink:"/pages/docs/development/services/base"}},d={},p=[{value:"Setup steps",id:"setup-steps",level:2},{value:"Files for plugins",id:"files-for-plugins",level:2},{value:"Dockerfile and docker-compose.yml",id:"dockerfile-and-docker-composeyml",level:3},{value:"plugin.json",id:"pluginjson",level:3},{value:"Publish plugin API",id:"publish-plugin-api",level:3},{value:"Publish plugin ui",id:"publish-plugin-ui",level:3},{value:"Running and testing",id:"running-and-testing",level:2},{value:"Build your code",id:"build-your-code",level:2},{value:"Github install",id:"github-install",level:2}];function c(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"plugin-development",children:"Plugin Development"})}),"\n",(0,i.jsx)(n.p,{children:"See the sample repos for how to get started and running a plugin in dev mode:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Go: ",(0,i.jsx)(n.a,{href:"https://github.com/spr-networks/spr-sample-plugin",children:"spr-sample-plugin"})]}),"\n",(0,i.jsxs)(n.li,{children:["JavaScript: ",(0,i.jsx)(n.a,{href:"https://github.com/spr-networks/spr-sample-plugin-js",children:"spr-sample-plugin-js"})]}),"\n",(0,i.jsxs)(n.li,{children:["Walkthrough: ",(0,i.jsx)(n.a,{href:"/pages/blog/spr-nexmon",children:"Building a Nexmon plugin"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"setup-steps",children:"Setup steps"}),"\n",(0,i.jsxs)(n.p,{children:["In the spr ui click ",(0,i.jsx)(n.em,{children:'"+ New Plugin"'})," under ",(0,i.jsx)(n.em,{children:"System -> Plugins"}),":\n",(0,i.jsx)(n.img,{alt:"extensions-plugin",src:s(46558).Z+"",width:"2642",height:"2042"})]}),"\n",(0,i.jsxs)(n.p,{children:["Add you info from ",(0,i.jsx)(n.a,{href:"#pluginjson",children:"plugin.json"})," here and start the plugin by ticking the switch."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Manually adding a plugin:"})}),"\n",(0,i.jsxs)(n.p,{children:["Add you info from ",(0,i.jsx)(n.a,{href:"#pluginjson",children:"plugin.json"})," to ",(0,i.jsx)(n.code,{children:"configs/base/api.json"})," under the ",(0,i.jsx)(n.em,{children:"Plugins"})," key, and whitelist your docker-compose.yml file in ",(0,i.jsx)(n.code,{children:"configs/base/custom_compose_paths.json"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# plugin location relative to SUPERDIR\nPDIR="plugins/user/plugin-name"\ncat <<< $(jq \'.Plugins += [input]\' configs/base/api.json $PDIR/plugin.json) > configs/base/api.json\ncat <<< $(cat configs/base/custom_compose_paths.json | jq ". + [\\"$PDIR/docker-compose.yml\\"]") > configs/base/custom_compose_paths.json\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"#running-and-testing",children:"Start your plugin"}),", and restart the api service to update the routes: ",(0,i.jsx)(n.code,{children:"docker-compose restart api"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"files-for-plugins",children:"Files for plugins"}),"\n",(0,i.jsx)(n.p,{children:"A minimal plugin will need the following files:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#dockerfile-and-docker-composeyml",children:"Dockerfile & docker-compose.yml"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#pluginjson",children:"plugin.json"})," for plugin info"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"dockerfile-and-docker-composeyml",children:"Dockerfile and docker-compose.yml"}),"\n",(0,i.jsx)(n.p,{children:"Notes on running and building:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"if you need to build code do this in a separate container and copy over the binary"}),"\n",(0,i.jsxs)(n.li,{children:["use the shared container image for running containers: ",(0,i.jsx)(n.code,{children:"ghcr.io/spr-networks/container_template:latest"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["See example ",(0,i.jsx)(n.a,{href:"https://github.com/spr-networks/spr-sample-plugin/blob/main/Dockerfile",children:"Dockerfile"})," for more info."]}),"\n",(0,i.jsx)(n.h3,{id:"pluginjson",children:"plugin.json"}),"\n",(0,i.jsxs)(n.p,{children:["This is the plugin.json file from ",(0,i.jsx)(n.a,{href:"https://github.com/spr-networks/spr-sample-plugin/blob/main/plugin.json",children:"spr-sample-plugin"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "Name": "spr-sample-plugin",\n  "ComposeFilePath": "plugins/user/spr-sample-plugin/docker-compose.yml",\n  "UnixPath": "/state/plugins/spr-sample-plugin/socket",\n  "URI": "spr-sample-plugin",\n  "HasUI": true,\n  "SandboxedUI": false,\n  "InstallTokenPath": "/configs/plugins/spr-sample-plugin/api-token",\n  "Enabled": true\n}\n'})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Key"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Name"}),(0,i.jsx)(n.td,{children:"Name of your plugin"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"ComposeFilePath"}),(0,i.jsx)(n.td,{children:"Location of docker-compose.yml relative to $SUPERDIR"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"UnixPath"}),(0,i.jsx)(n.td,{children:"Location of unix socket relative to $SUPERDIR"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"URI"}),(0,i.jsx)(n.td,{children:"Name of your plugin url, will expose api @ /plugins/URI/"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"HasUI"}),(0,i.jsx)(n.td,{children:"If your plugin have UI code"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"SandboxedUI"}),(0,i.jsx)(n.td,{children:"Not in use"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"InstallTokenPath"}),(0,i.jsx)(n.td,{children:"Location of token relative to $SUPERDIR"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Enabled"}),(0,i.jsx)(n.td,{children:"If your plugin should be enabled"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"publish-plugin-api",children:"Publish plugin API"}),"\n",(0,i.jsxs)(n.p,{children:["If your plugin have an api you can proxy it via spr  by setting ",(0,i.jsx)(n.em,{children:"UnixPath"})," and ",(0,i.jsx)(n.em,{children:"URI"})," in plugin.json.\nYour plugin api should now be available at ",(0,i.jsx)(n.code,{children:"/plugins/URI/"})]}),"\n",(0,i.jsx)(n.h3,{id:"publish-plugin-ui",children:"Publish plugin ui"}),"\n",(0,i.jsxs)(n.p,{children:["If you have an ui talking to the api, specify this in plugin.json by setting ",(0,i.jsx)(n.code,{children:"HasUI: true"}),".\nYour ui should now be available at ",(0,i.jsx)(n.code,{children:"/plugins/URI/index.html"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["If HasUI is set to true, your plugin should be listed in the navigation under ",(0,i.jsx)(n.em,{children:"Custom Plugins"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"running-and-testing",children:"Running and testing"}),"\n",(0,i.jsx)(n.p,{children:"To manually start your plugin:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"export SUPERDIR=/home/spr/super # spr root directory\ncd $SUPERDIR/plugins/user/spr-sample-plugin\ndocker-compose up -d\n"})}),"\n",(0,i.jsx)(n.p,{children:"Test if your service is up:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl --unix-socket $SUPERDIR/state/plugins/spr-sample-plugin/socket http://localhost/test\n"})}),"\n",(0,i.jsxs)(n.p,{children:["if you have published your api and have local ui code, see the guide on how to run your ",(0,i.jsx)(n.a,{href:"https://github.com/spr-networks/spr-sample-plugin?tab=readme-ov-file#frontend---ui-code",children:"ui code in dev mode"})]}),"\n",(0,i.jsx)(n.h2,{id:"build-your-code",children:"Build your code"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"export SUPERDIR=/home/spr/super/ # spr root directory\nmkdir -p $SUPERDIR/state/plugins/spr-sample-plugin\n# where your plugin code/repository is located\ncd $SUPERDIR/plugins/user/spr-sample-plugin\nexport DOCKER_BUILDKIT=1\ndocker-compose build\ndocker-compose up -d\n# verify its running\ncurl --unix-socket $SUPERDIR/state/plugins/spr-sample-plugin/socket http://localhost/test\ncurl --unix-socket $SUPERDIR/state/plugins/spr-sample-plugin/socket http://localhost/index.html\n"})}),"\n",(0,i.jsx)(n.h2,{id:"github-install",children:"Github install"}),"\n",(0,i.jsxs)(n.p,{children:["If you have a template for your plugin in a github repository you can use the github install:\n",(0,i.jsx)(n.img,{alt:"plugin-github-install",src:s(43376).Z+"",width:"2732",height:"874"})]}),"\n",(0,i.jsxs)(n.p,{children:["Plugins installed with github install will be located in ",(0,i.jsx)(n.code,{children:"$SUPERDIR/plugins/user/"}),"."]})]})}function a(e={}){const{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},46558:(e,n,s)=>{s.d(n,{Z:()=>i});const i=s.p+"assets/images/extensions-plugin-051105bcdda3d5dd72926a43169a94c3.png"},43376:(e,n,s)=>{s.d(n,{Z:()=>i});const i=s.p+"assets/images/plugin-github-install-9e6c2b755bf051451e46452de4b5724f.png"},11151:(e,n,s)=>{s.d(n,{Z:()=>o,a:()=>t});var i=s(67294);const l={},r=i.createContext(l);function t(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);