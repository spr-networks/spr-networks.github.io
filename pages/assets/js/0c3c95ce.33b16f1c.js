"use strict";(self.webpackChunkspr_docs=self.webpackChunkspr_docs||[]).push([[9641],{33098:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var t=s(85893),a=s(11151);const o={slug:"macos-smb-flaws",title:"SMB Flaws in MacOS",authors:["ltsrad","daveg"],tags:["smb","fuzzing","macos","apple"]},r=void 0,i={permalink:"/pages/blog/macos-smb-flaws",source:"@site/blog/2025-07-01-smblient.md",title:"SMB Flaws in MacOS",description:"Over the winter we took a look at mac OS networking flaws and uncovered several crashes with SMB, including remotely triggerable kernel memory corruption.",date:"2025-07-01T00:00:00.000Z",tags:[{inline:!0,label:"smb",permalink:"/pages/blog/tags/smb"},{inline:!0,label:"fuzzing",permalink:"/pages/blog/tags/fuzzing"},{inline:!0,label:"macos",permalink:"/pages/blog/tags/macos"},{inline:!0,label:"apple",permalink:"/pages/blog/tags/apple"}],readingTime:1.35,hasTruncateMarker:!0,authors:[{name:"Alex Radocea",url:"https://twitter.com/defendtheworld",key:"ltsrad",page:null},{name:"Dave G",key:"daveg",page:null}],frontMatter:{slug:"macos-smb-flaws",title:"SMB Flaws in MacOS",authors:["ltsrad","daveg"],tags:["smb","fuzzing","macos","apple"]},unlisted:!1,nextItem:{title:"We've Added Guest SSID Support",permalink:"/pages/blog/guest-ssid-on-spr"}},l={authorsImageUrls:[void 0,void 0]},d=[{value:"Background",id:"background",level:2},{value:"Demo",id:"demo",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,a.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Over the winter we took a look at mac OS networking flaws and uncovered several crashes with SMB, including remotely triggerable kernel memory corruption."}),"\n",(0,t.jsxs)(n.p,{children:["Our advisory is available at ",(0,t.jsx)(n.a,{href:"http://supernetworks.org/advisores/smbclient-2025.html",children:"http://supernetworks.org/advisores/smbclient-2025.html"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"background",children:"Background"}),"\n",(0,t.jsx)(n.p,{children:"Server Message Block has been around since 1983 and continues to provide a steady stream of remote surface bugs, in new and old code alike."}),"\n",(0,t.jsxs)(n.p,{children:["These flaws were patched in ",(0,t.jsx)(n.a,{href:"https://support.apple.com/en-us/12237",children:"macOS 15.4"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["On Linux Doyensec found a substantial series of flaws with ",(0,t.jsx)(n.a,{href:"https://blog.doyensec.com/2025/01/07/ksmbd-1.html",children:"ksmbd"}),",\nwhich Sean Heelan has also been using to ",(0,t.jsx)(n.a,{href:"https://sean.heelan.io/2025/05/22/how-i-used-o3-to-find-cve-2025-37899-a-remote-zeroday-vulnerability-in-the-linux-kernels-smb-implementation/",children:"evaluate o3 and other LLM's bug finding abilities"}),". After SMBleed and SMBGhost, ",(0,t.jsx)(n.a,{href:"https://support.apple.com/en-us/122373",children:"more flaws"})," keep popping up in Microsoft's implementation as well."]}),"\n",(0,t.jsx)(n.h2,{id:"demo",children:"Demo"}),"\n",(0,t.jsx)(n.p,{children:"CVE-2025-24269 is exactly the kind of flaw an LLM happens to be very good at. The code path has a helpful prompt stating developer exasperation with the length checks,\nand a commented out bounds check."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'#if 0\n                    /*\n                     * Oddly, Windows server will send a compress length that\n                     * is bigger than the decompressed length which will cause\n                     * this check to fail. Why they dont just send the non\n                     * compressed data?\n                     *\n                     * Sanity check the compress length\n                     */\n                    if (compress_len > (originalCompressedSegmentSize - CurrentDecompressedDataSize)) {  [2]\n                        SMBERROR("Algorithm %d compress_len %d > remaining to decompress len %d? \\n",\n                                 algorithm, compress_len,\n                                 (originalCompressedSegmentSize - CurrentDecompressedDataSize));\n                        error = EINVAL;\n                        goto bad;\n                    }\n#endif\u2028\u2026\n'})}),"\n",(0,t.jsx)(n.p,{children:"As the buffer is in a data zone, exploitation will require finding kernel space data buffers worth corrupting remotely, or a bypass of Apple's heap zone hardening countermeasures.\nWe put together a video of CVE-2025-24269 crashing:"}),"\n",(0,t.jsx)("div",{children:(0,t.jsx)("video",{width:"100%",height:"100%",playsInline:!0,controls:!0,src:"/pages/video/blogs/smbclient/2025-03-31-smbclient.mov",type:"video/mp4"})})]})}function p(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},11151:(e,n,s)=>{s.d(n,{Z:()=>i,a:()=>r});var t=s(67294);const a={},o=t.createContext(a);function r(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);