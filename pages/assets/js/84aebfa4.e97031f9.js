"use strict";(self.webpackChunkspr_docs=self.webpackChunkspr_docs||[]).push([[1409],{73410:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var i=s(85893),t=s(11151);const r={slug:"virtual SPR",title:"SPR in the cloud",authors:"ltspo",tags:["SPR","Virtual","Cloud","VPN","WireGuard"]},l=void 0,o={permalink:"/pages/blog/virtual SPR",source:"@site/blog/2022-09-07-virtual-spr.md",title:"SPR in the cloud",description:"Introduction",date:"2022-09-07T00:00:00.000Z",tags:[{inline:!0,label:"SPR",permalink:"/pages/blog/tags/spr"},{inline:!0,label:"Virtual",permalink:"/pages/blog/tags/virtual"},{inline:!0,label:"Cloud",permalink:"/pages/blog/tags/cloud"},{inline:!0,label:"VPN",permalink:"/pages/blog/tags/vpn"},{inline:!0,label:"WireGuard",permalink:"/pages/blog/tags/wire-guard"}],readingTime:3.185,hasTruncateMarker:!0,authors:[{name:"Philip Olausson",url:"https://twitter.com/capslcc",key:"ltspo",page:null}],frontMatter:{slug:"virtual SPR",title:"SPR in the cloud",authors:"ltspo",tags:["SPR","Virtual","Cloud","VPN","WireGuard"]},unlisted:!1,prevItem:{title:"Run Virtual SPR on a DigitalOcean Droplet",permalink:"/pages/blog/virtual-spr-on-a-digital-ocean-droplet"},nextItem:{title:"Securely Chaining Routers",permalink:"/pages/blog/secure router chaining"}},a={authorsImageUrls:[void 0]},c=[{value:"Introduction",id:"introduction",level:2},{value:"Virtual SPR Install",id:"virtual-spr-install",level:2},{value:"Configure the VPN client on your device",id:"configure-the-vpn-client-on-your-device",level:2},{value:"Admin interface",id:"admin-interface",level:2},{value:"Modify Blocklists",id:"modify-blocklists",level:2},{value:"View traffic",id:"view-traffic",level:2},{value:"Outro and random notes",id:"outro-and-random-notes",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(n.p,{children:"This guide will show how to setup virtual SPR and connect to it using a WireGuard VPN client from your phone or desktop computer."}),"\n",(0,i.jsx)(n.p,{children:"The result is a private VPN with a custom DNS server able to block ads, log traffic, and more."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Quick install"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:'sudo bash -c "$(curl -fsSL https://raw.github.com/spr-networks/super/master/virtual_install.sh)"\n'})}),"\n",(0,i.jsx)(n.p,{children:"Open WireGuard & scan the QR Code/import config - Done!"}),"\n",(0,i.jsx)(n.h2,{id:"virtual-spr-install",children:"Virtual SPR Install"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"What you need"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A linux server running Ubuntu 22.04"}),"\n",(0,i.jsxs)(n.li,{children:["If there is a firewall ",(0,i.jsx)(n.em,{children:"port 51280/udp"})," needs to be open for incoming traffic"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://www.wireguard.com/install/",children:"WireGuard"})," (",(0,i.jsx)(n.em,{children:"\xa9 Jason A. Donenfeld"}),") installed on your client phone or desktop","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"apt install wireguard"})," for ubuntu"]}),"\n",(0,i.jsxs)(n.li,{children:["Official clients for ",(0,i.jsx)(n.a,{href:"https://download.wireguard.com/windows-client/wireguard-installer.exe",children:"Windows"}),", ",(0,i.jsx)(n.a,{href:"https://itunes.apple.com/us/app/wireguard/id1451685025?ls=1&mt=12",children:"macOS"}),", ",(0,i.jsx)(n.a,{href:"https://itunes.apple.com/us/app/wireguard/id1441195209?ls=1&mt=8",children:"iOS"}),", ",(0,i.jsx)(n.a,{href:"https://play.google.com/store/apps/details?id=com.wireguard.android",children:"Android"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Run Virtual Installer"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:'sudo bash -c "$(curl -fsSL https://raw.github.com/spr-networks/super/master/virtual_install.sh)"\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"What the script does"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["downloads the latest SPR repository from ",(0,i.jsx)(n.a,{href:"https://github.com/spr-networks/super/",children:"https://github.com/spr-networks/super/"})]}),"\n",(0,i.jsx)(n.li,{children:"downloads prebuilt docker images"}),"\n",(0,i.jsx)(n.li,{children:"generate default configs"}),"\n",(0,i.jsx)(n.li,{children:"setup admin password and auth token for API access"}),"\n",(0,i.jsx)(n.li,{children:"start SPR"}),"\n",(0,i.jsx)(n.li,{children:"add a VPN peer and output the WireGuard config"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"You can also download the script if you want to check it out or add blocklists for ads:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"curl -s -O https://raw.githubusercontent.com/spr-networks/super/main/virtual_install.sh\nchmod +x virtual_install.sh\nsudo DNS_BLOCK=hosts,ads,tracking,redirects ./virtual_install.sh\n"})}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"https://github.com/blocklistproject/Lists",children:"here"})," for available blocklists."]}),"\n",(0,i.jsx)(n.p,{children:"Example to block DNS requests to adservers and social media:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"sudo DNS_BLOCK=ads,tracking,facebook,tiktok ./virtual_install.sh\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If you want to change the admin password you can edit the file ",(0,i.jsx)(n.code,{children:"configs/base/auth_users.json"})]}),"\n",(0,i.jsx)(n.p,{children:"Running the script you should see login info, a QR Code & the WireGuard client config. Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"...\n[+] WireGuard config: (save this as wg.conf & import in client)\n----------------------------------------------------------\n\n[Interface]\nPrivateKey = privkey\nAddress = 192.168.2.94\nDNS = 192.168.2.1\n\n[Peer]\nPublicKey = pubkey\nAllowedIPs = 0.0.0.0/0, ::/0\nEndpoint = 198.211.120.224:51280\nPersistentKeepalive = 25\nPresharedKey = psk\n"})}),"\n",(0,i.jsx)(n.p,{children:"If you want to connect to the VPN using a desktop client, save the config as wg.conf on your local computer."}),"\n",(0,i.jsx)(n.h2,{id:"configure-the-vpn-client-on-your-device",children:"Configure the VPN client on your device"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"For iOS and Android"})}),"\n",(0,i.jsxs)(n.p,{children:["Scan the QR Code in the official WireGuard App (",(0,i.jsx)(n.a,{href:"https://itunes.apple.com/us/app/wireguard/id1441195209?ls=1&mt=8",children:"iOS"}),", ",(0,i.jsx)(n.a,{href:"https://play.google.com/store/apps/details?id=com.wireguard.android",children:"Android"}),") to import your VPN profile."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Linux, macOS and Windows"})}),"\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.em,{children:'"Add empty tunnel..."'})," paste the config and set a name for the tunnel. Or, if you saved the config to a file:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Open your WireGuard client and click ",(0,i.jsx)(n.em,{children:'"Import tunnel(s) from file"'})]}),"\n",(0,i.jsx)(n.li,{children:"Select the wg.conf file"}),"\n",(0,i.jsx)(n.li,{children:"Click Activate"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"admin-interface",children:"Admin interface"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:s(96120).Z+"",width:"1998",height:"1010"})}),"\n",(0,i.jsxs)(n.p,{children:["Make sure you're connected to the VPN endpoint & browse to ",(0,i.jsx)(n.a,{href:"http://192.168.2.1",children:"http://192.168.2.1"})," to access the admin interface."]}),"\n",(0,i.jsxs)(n.p,{children:["Login using the credentials shown in the output from the script or if you set the password manually (",(0,i.jsx)(n.em,{children:"NOTE"})," you can check the login info by running ",(0,i.jsx)(n.code,{children:"SKIP_VPN=1 ./virtual_install.sh"}),")."]}),"\n",(0,i.jsx)(n.p,{children:"If you prefer to use curl:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:'$ export TOKEN="BASE64-TOKEN-FROM-OUTPUT"\n$ curl -s -H "Authorization: Bearer $TOKEN" 192.168.2.1/devices\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Checkout the ",(0,i.jsx)(n.a,{href:"https://www.supernetworks.org/pages/api/0#section/Introduction",children:"documentation"})," to get started using the SPR API."]}),"\n",(0,i.jsx)(n.h2,{id:"modify-blocklists",children:"Modify Blocklists"}),"\n",(0,i.jsxs)(n.p,{children:["In the admin interface you can enable more blocklists by clicking ",(0,i.jsx)(n.em,{children:"Blocklists/Ad-block"})," under DNS:\n",(0,i.jsx)(n.img,{src:s(88950).Z+"",width:"1974",height:"940"})]}),"\n",(0,i.jsxs)(n.p,{children:["SPR comes bundled with the hosts file from ",(0,i.jsx)(n.a,{href:"https://github.com/StevenBlack/hosts",children:"https://github.com/StevenBlack/hosts"})," and the blocklists from the ",(0,i.jsx)(n.a,{href:"https://github.com/blocklistproject/Lists",children:"https://github.com/blocklistproject/Lists"})," repository, including:\n",(0,i.jsx)(n.em,{children:"redirect, ads, facebook, twitter, malware, porn, redirect, tracking, youtube, everything"})]}),"\n",(0,i.jsx)(n.p,{children:"If something is missing you can always add custom blocklists or block specific domains."}),"\n",(0,i.jsx)(n.h2,{id:"view-traffic",children:"View traffic"}),"\n",(0,i.jsxs)(n.p,{children:["Navigate to ",(0,i.jsx)(n.em,{children:"DNS Log"})," in the DNS category, select the client to get a log of domains:\n",(0,i.jsx)(n.img,{src:s(24154).Z+"",width:"1990",height:"944"})]}),"\n",(0,i.jsxs)(n.p,{children:["Here you can also add more blocks, domain overrides if you want to allow something temporarily, delete logs or disable them completely under ",(0,i.jsx)(n.em,{children:"Settings"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["It is also possible to get more detail traffic for connections under ",(0,i.jsx)(n.em,{children:"Traffic"}),":\n",(0,i.jsx)(n.img,{src:s(62160).Z+"",width:"2086",height:"880"})]}),"\n",(0,i.jsx)(n.h2,{id:"outro-and-random-notes",children:"Outro and random notes"}),"\n",(0,i.jsx)(n.p,{children:"You can remove lan from your device groups for a device but its needed to access the admin interface."}),"\n",(0,i.jsx)(n.p,{children:"SPR is configured to use DNS over HTTPs when resolving domains. You can modify the Coredns configuration under configs/dns/Corefile"})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},88950:(e,n,s)=>{s.d(n,{Z:()=>i});const i=s.p+"assets/images/screenshot_dns_blocklist-579c25c2088d86938ca50e098f225501.png"},24154:(e,n,s)=>{s.d(n,{Z:()=>i});const i=s.p+"assets/images/screenshot_dns_log-370b2aa4ba0241c3e494facd7d4dcec9.png"},96120:(e,n,s)=>{s.d(n,{Z:()=>i});const i=s.p+"assets/images/screenshot_login-d6eccf46d43c7a5a3cdd6d7872ff7415.png"},62160:(e,n,s)=>{s.d(n,{Z:()=>i});const i=s.p+"assets/images/screenshot_traffic-2f69a0c1ea6d51d18677a11246c41bdd.png"},11151:(e,n,s)=>{s.d(n,{Z:()=>o,a:()=>l});var i=s(67294);const t={},r=i.createContext(t);function l(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);